<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>new_* functions • Recca</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="new_* functions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Recca</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Recca.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/new-function-interaction.html">new_* function interactions</a>
    </li>
    <li>
      <a href="../articles/new-functions.html">new_* functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MatthewHeun/Recca">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="new-functions_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="new-functions_files/d3-4.5.0/d3.min.js"></script><script src="new-functions_files/sankey-1/sankey.js"></script><script src="new-functions_files/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>new_* functions</h1>
                        <h4 class="author">Matthew Kuperus Heun</h4>
            
            <h4 class="date">2019-02-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/Recca/blob/master/vignettes/new-functions.Rmd"><code>vignettes/new-functions.Rmd</code></a></small>
      <div class="hidden name"><code>new-functions.Rmd</code></div>

    </div>

    
    
<!-- Establish some helpful LaTeX shortcuts for equations -->
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>Recca</code> is an <code>R</code> package that builds upon input-output (I-O) analysis to analyze energy conversion chains (ECCs). Historically, input-output (I-O) analysis has been used to analyze “what-if” scenarios involving changes to the production structure of an economy. A common scenario asks “how will will the structure of intermediate industries (represented by <span class="math inline">\({\mathbf{U}}\)</span> and <span class="math inline">\({\mathbf{V}}\)</span> matrices) change when final demand (represented by the <span class="math inline">\({\mathbf{Y}}\)</span> matrix) changes?” In the economic arena, Leontief’s early work answered this question via a matrix inversion that now bears his name, the “Leontief inverse (<span class="math inline">\({\mathbf{L}}\)</span>)” <span class="citation">(Leontief 1941)</span>. Analysts with an I-O background will know the famous equation <span class="math inline">\({\mathbf{L}} = ({\mathbf{I}} - {\mathbf{A}})^{-1}\)</span>.</p>
<p>The <code>Recca</code> package provides functions that perform several “what if” analyses for the analyst. Each function has the name <code>new_*</code>, where <code>*</code> indicates the changed matrix or portion of the ECC. Some functions have the suffix <code>_ps</code> to indicate the functions assume perfect substitution (<code>ps</code>) of industry inputs throughout the ECC. The <code>new_*</code> functions return the resource (<span class="math inline">\({\mathbf{R}}\)</span>), use (<span class="math inline">\({\mathbf{U}}\)</span>), make (<span class="math inline">\({\mathbf{V}}\)</span>), and final demand (<span class="math inline">\({\mathbf{Y}}\)</span>) matrices that would be present under the conditions given by arguments to the <code>new_*</code> functions. Arguments for “new” versions of vectors or matrices are given the suffix <code>_prime</code> in the <code>new_*</code> functions. For example, the updated version of the use (<span class="math inline">\({\mathbf{U}}\)</span>) matrix is called <code>U_prime</code>.</p>
<p>For the examples that follow, we’ll use one ECC from the <code>UKEnergy2000mats</code> data frame which represents primary and final energy flows through a portion of the UK in the year 2000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(matsbyname)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(matsindf)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Recca)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)
OurECC &lt;-<span class="st"> </span>UKEnergy2000mats <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Last.stage <span class="op">==</span><span class="st"> "final"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(<span class="dt">key =</span> <span class="st">"matrix.name"</span>, <span class="dt">value =</span> <span class="st">"matrix"</span>)
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(OurECC)
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 9</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GB"</span>
<span class="co">#&gt; $ Year        &lt;int&gt; 2000</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E.ktoe"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "final"</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ U           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ V           &lt;list&gt; [&lt;matrix[11 x 12]&gt;]</span>
<span class="co">#&gt; $ Y           &lt;list&gt; [&lt;matrix[4 x 2]&gt;]</span></code></pre></div>
<p>After a short discussion of the inputs to the <code>new_*</code> functions, each type of analysis is described in turn.</p>
</div>
<div id="inputs-to-new_-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#inputs-to-new_-functions" class="anchor"></a>Inputs to <code>new_*</code> functions</h2>
<p>Inputs to the <code>new_*</code> functions include matrices that describe the ECC and matrices that describe the input-output structure of the ECC.</p>
<div id="matrices-that-describe-the-ecc" class="section level3">
<h3 class="hasAnchor">
<a href="#matrices-that-describe-the-ecc" class="anchor"></a>Matrices that describe the ECC</h3>
<p>The <code>new_*</code> functions take as inputs resource (<span class="math inline">\({\mathbf{R}}\)</span>), use (<span class="math inline">\({\mathbf{U}}\)</span>), make (<span class="math inline">\({\mathbf{V}}\)</span>), and final demand (<span class="math inline">\({\mathbf{Y}}\)</span>) matrices that describe the ECC. Earlier versions of <code>Recca</code> included the resource matrix (<span class="math inline">\({\mathbf{R}}\)</span>) with the make (<span class="math inline">\({\mathbf{V}}\)</span>) matrix. To separate the resource matrix <span class="math inline">\({\mathbf{R}}\)</span> from the make matrix (<span class="math inline">\({\mathbf{V}}\)</span>), use the <code><a href="../reference/separate_RV.html">separate_RV()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UKEnergyMatsWithR &lt;-<span class="st"> </span>OurECC <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># The following code is necessary until R matrices are included</span>
<span class="st">  </span><span class="co"># in the UKEnergy2000mats data frame.</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(
    <span class="dt">R_plus_V =</span> V
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/separate_RV.html">separate_RV</a></span>()
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(UKEnergyMatsWithR)
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 11</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GB"</span>
<span class="co">#&gt; $ Year        &lt;int&gt; 2000</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E.ktoe"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "final"</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ U           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ R_plus_V    &lt;list&gt; [&lt;matrix[11 x 12]&gt;]</span>
<span class="co">#&gt; $ Y           &lt;list&gt; [&lt;matrix[4 x 2]&gt;]</span>
<span class="co">#&gt; $ R           &lt;list&gt; [&lt;matrix[2 x 12]&gt;]</span>
<span class="co">#&gt; $ V           &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span></code></pre></div>
<p>To look at the ECC, we can draw a Sankey diagram. A Sankey diagram for the first row of the <code>UKEnergyMatsWithR</code> data frame is given below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(UKEnergyMatsWithR) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Extracts the "Sankey" column</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="co"># Extracts the first row of the "Sankey" column</span></code></pre></div>
<div id="htmlwidget-ce0f1654689da3381713" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ce0f1654689da3381713">{"x":{"links":{"source":[0,1,1,2,2,3,3,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,7,8,8,9,9,3,10,10,1,4,6,9,8,2,3,10,5],"target":[2,1,3,1,2,4,3,1,4,9,8,2,10,11,6,1,9,8,2,3,5,12,9,5,12,9,8,10,10,11,13,13,13,13,13,13,13,13,13],"value":[50000,500,47000,47500,2500,15500,5000,25,350,50,25,50,250,14750,6400,25,25,25,25,75,100,6000,43000,16000,25000,2000,41000,26500,500,26000,550,350,125,2075,50,2575,5075,750,9700]},"nodes":{"name":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"],"group":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="matrices-that-describe-the-input-output-structure-of-the-ecc" class="section level3">
<h3 class="hasAnchor">
<a href="#matrices-that-describe-the-input-output-structure-of-the-ecc" class="anchor"></a>Matrices that describe the input-output structure of the ECC</h3>
<p>Each <code>new_*</code> function requires basic knowledge about the I-O structure of the ECCs in the form of named vectors and matrices. The <code>calc_io_mats</code> function is the simplest way to obtain the I-O structure which appears as additional columns appended at the right of the data frame. (The names of the additional columns are given by arguments to the <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code> function.)</p>
<p>The first step in any “what-if” analysis is to calculate the input-output structure of the energy conversion chain. The <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code> function adds several columns to the <code>UKEnergyMatsWithR</code> data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">IO_mats &lt;-<span class="st"> </span>UKEnergyMatsWithR <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Obtain the I-O structure of the ECCs</span>
<span class="st">  </span><span class="kw"><a href="../reference/calc_io_mats.html">calc_io_mats</a></span>()
<span class="co"># Note additional columns appended to the data frame.</span>
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(IO_mats)
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 23</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GB"</span>
<span class="co">#&gt; $ Year        &lt;int&gt; 2000</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E.ktoe"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "final"</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ U           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ R_plus_V    &lt;list&gt; [&lt;matrix[11 x 12]&gt;]</span>
<span class="co">#&gt; $ Y           &lt;list&gt; [&lt;matrix[4 x 2]&gt;]</span>
<span class="co">#&gt; $ R           &lt;list&gt; [&lt;matrix[2 x 12]&gt;]</span>
<span class="co">#&gt; $ V           &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ y           &lt;list&gt; [&lt;matrix[4 x 1]&gt;]</span>
<span class="co">#&gt; $ q           &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ f           &lt;list&gt; [&lt;matrix[9 x 1]&gt;]</span>
<span class="co">#&gt; $ g           &lt;list&gt; [&lt;matrix[9 x 1]&gt;]</span>
<span class="co">#&gt; $ W           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ Z           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ K           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ C           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ D           &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ A           &lt;list&gt; [&lt;matrix[12 x 12]&gt;]</span>
<span class="co">#&gt; $ L_pxp       &lt;list&gt; [&lt;matrix[12 x 12]&gt;]</span>
<span class="co">#&gt; $ L_ixp       &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span></code></pre></div>
<p>With the I-O structure of the ECC determined (and represented by the <span class="math inline">\({\mathbf{q}}\)</span>, <span class="math inline">\({\mathbf{f}}\)</span>, and <span class="math inline">\({\mathbf{g}}\)</span> vectors and the <span class="math inline">\({\mathbf{W}}\)</span>, <span class="math inline">\({\mathbf{Z}}\)</span>, <span class="math inline">\({\mathbf{K}}\)</span>, <span class="math inline">\({\mathbf{C}}\)</span>, <span class="math inline">\({\mathbf{D}}\)</span>, <span class="math inline">\({\mathbf{A}}\)</span>, <span class="math inline">\({\mathbf{L_{pxp}}}\)</span>, and <span class="math inline">\({\mathbf{L_{ixp}}}\)</span> matrices), we can use the <code>new_*</code> functions to ask “what if” questions.</p>
</div>
</div>
<div id="what-if-final-demand-changes-function-new_y" class="section level2">
<h2 class="hasAnchor">
<a href="#what-if-final-demand-changes-function-new_y" class="anchor"></a>What if final demand changes? Function new_Y()</h2>
<p>The classic I-O question is “what if final demand (<span class="math inline">\({\mathbf{Y}}\)</span>) changes?” <code>Recca</code> has a function for that, <code><a href="../reference/new_Y.html">new_Y()</a></code>. The <code><a href="../reference/new_Y.html">new_Y()</a></code> function looks upstream in the ECC to determine the effects of a change in final demand. To demonstrate, we’ll double the <code>Residential</code> final demand for electricity from the grid (<code>Elect - Grid</code>) in our ECC.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">double &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  <span class="dv">2</span><span class="op">*</span>x
}

DoubleRes &lt;-<span class="st"> </span>IO_mats <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="dt">Y_prime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/elementapply_byname">elementapply_byname</a></span>(double, <span class="dt">a =</span> Y, <span class="dt">row =</span> <span class="st">"Elect - Grid"</span>, <span class="dt">col =</span> <span class="st">"Residential"</span>)
  )
DoubleRes<span class="op">$</span>Y[[<span class="dv">1</span>]]
<span class="co">#&gt;                Residential Transport</span>
<span class="co">#&gt; Diesel - Dist.           0     14750</span>
<span class="co">#&gt; Elect - Grid          6000         0</span>
<span class="co">#&gt; NG - Dist.           25000         0</span>
<span class="co">#&gt; Petrol - Dist.           0     26000</span>
<span class="co">#&gt; attr(,"rowtype")</span>
<span class="co">#&gt; [1] "Product"</span>
<span class="co">#&gt; attr(,"coltype")</span>
<span class="co">#&gt; [1] "Industry"</span>
DoubleRes<span class="op">$</span>Y_prime[[<span class="dv">1</span>]]
<span class="co">#&gt;                Residential Transport</span>
<span class="co">#&gt; Diesel - Dist.           0     14750</span>
<span class="co">#&gt; Elect - Grid         12000         0</span>
<span class="co">#&gt; NG - Dist.           25000         0</span>
<span class="co">#&gt; Petrol - Dist.           0     26000</span>
<span class="co">#&gt; attr(,"rowtype")</span>
<span class="co">#&gt; [1] "Product"</span>
<span class="co">#&gt; attr(,"coltype")</span>
<span class="co">#&gt; [1] "Industry"</span></code></pre></div>
<p>Now we can use the <code><a href="../reference/new_Y.html">new_Y()</a></code> function to estimate the ECC with the larger final demand for residential electricity. The original Sankey diagram is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(UKEnergyMatsWithR) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Extracts the "Sankey" column</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="co"># Extracts the first row of the "Sankey" column</span></code></pre></div>
<div id="htmlwidget-932f3baeb49fc5be8264" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-932f3baeb49fc5be8264">{"x":{"links":{"source":[0,1,1,2,2,3,3,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,7,8,8,9,9,3,10,10,1,4,6,9,8,2,3,10,5],"target":[2,1,3,1,2,4,3,1,4,9,8,2,10,11,6,1,9,8,2,3,5,12,9,5,12,9,8,10,10,11,13,13,13,13,13,13,13,13,13],"value":[50000,500,47000,47500,2500,15500,5000,25,350,50,25,50,250,14750,6400,25,25,25,25,75,100,6000,43000,16000,25000,2000,41000,26500,500,26000,550,350,125,2075,50,2575,5075,750,9700]},"nodes":{"name":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"],"group":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>The new Sankey diagram is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DoubleRes &lt;-<span class="st"> </span>DoubleRes <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/new_Y.html">new_Y</a></span>()
<span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(DoubleRes, <span class="dt">U =</span> <span class="st">"U_prime"</span>, <span class="dt">V =</span> <span class="st">"V_prime"</span>, <span class="dt">Y =</span> <span class="st">"Y_prime"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>)</code></pre></div>
<div id="htmlwidget-0a4b786021bff4ddf9d7" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a4b786021bff4ddf9d7">{"x":{"links":{"source":[0,1,1,2,2,3,3,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,7,8,8,9,9,3,10,10,1,4,6,9,8,2,3,10,5],"target":[2,1,3,1,2,4,3,1,4,9,8,2,10,11,6,1,9,8,2,3,5,12,9,5,12,9,8,10,10,11,13,13,13,13,13,13,13,13,13],"value":[50034.8117944957,500.348117944957,47032.7230868259,47533.0712047709,2501.74058972478,15529.2419073764,5003.48117944957,25.0174058972478,350.660301134305,69.0195923668707,34.5097961834353,50.0348117944957,250,14750,12638.4262963336,25.0174058972478,34.5097961834353,34.5097961834353,25.0174058972478,75.0522176917435,197.475410880212,12000,59356.8494355088,31596.065740834,25000,2760.78369467483,56596.065740834,26500,500,26000,550.382929739455,350.660301134305,246.844263600266,2864.31308322512,69.0195923668707,2576.79280741652,5078.53339714131,750,19155.1148553806]},"nodes":{"name":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"],"group":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>Output from the electric grid is clearly larger now than before. Also, upstream demand for natural gas is now larger than the upstream demand for crude, whereas in the original Sankey diagram, demand for crude was larger than the demand for natural gas.</p>
</div>
<div id="what-if-resources-change-function-new_r_ps" class="section level2">
<h2 class="hasAnchor">
<a href="#what-if-resources-change-function-new_r_ps" class="anchor"></a>What if resources change? Function new_R_ps()</h2>
<p><code>newY()</code> estimates the upstream effects of a change to final demand. But what if we want to understand the downstream effects of a change in resource availability? The function <code><a href="../reference/new_R_ps.html">new_R_ps()</a></code> supplies the answer. <code><a href="../reference/new_R_ps.html">new_R_ps()</a></code> takes as input the input-output structure of an ECC and the efficiency of every intermediate industry. After discussing the resource matrix and resource vectors,</p>
<div id="resource-matrices-and-vectors" class="section level3">
<h3 class="hasAnchor">
<a href="#resource-matrices-and-vectors" class="anchor"></a>Resource matrices and vectors</h3>
<p>The rate of resource extraction is given by the <span class="math inline">\({\mathbf{R}}\)</span> matrix or by the <span class="math inline">\({\mathbf{r}}\)</span> vector. The resource matrix (<span class="math inline">\({\mathbf{R}}\)</span>) is Industry<span class="math inline">\(\times\)</span>Product. Its industries are usually named <code>Resources - &lt;Product&gt;</code>, where <code>&lt;Product&gt;</code> is the name of the Product produced by that industry. (<code><a href="https://www.rdocumentation.org/packages/matsbyname/topics/clean_byname">clean_byname()</a></code> removes <code>0</code> rows and columns for clarity.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UKEnergyMatsWithR<span class="op">$</span>R[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/clean_byname">clean_byname</a></span>()
<span class="co">#&gt;                   Crude    NG</span>
<span class="co">#&gt; Resources - Crude 50000     0</span>
<span class="co">#&gt; Resources - NG        0 43000</span>
<span class="co">#&gt; attr(,"rowtype")</span>
<span class="co">#&gt; [1] "Industry"</span>
<span class="co">#&gt; attr(,"coltype")</span>
<span class="co">#&gt; [1] "Product"</span></code></pre></div>
<p>The resource vector (<span class="math inline">\({\mathbf{r}}\)</span>) is a Product column vector containing Products that are resources.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rvecs &lt;-<span class="st"> </span>UKEnergyMatsWithR <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(
    <span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/clean_byname">clean_byname</a></span>(R) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/colsums_byname">colsums_byname</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/transpose_byname">transpose_byname</a></span>()
  )
rvecs<span class="op">$</span>r[[<span class="dv">1</span>]]
<span class="co">#&gt;       Industry</span>
<span class="co">#&gt; Crude    50000</span>
<span class="co">#&gt; NG       43000</span>
<span class="co">#&gt; attr(,"rowtype")</span>
<span class="co">#&gt; [1] "Product"</span>
<span class="co">#&gt; attr(,"coltype")</span>
<span class="co">#&gt; [1] "Industry"</span></code></pre></div>
</div>
<div id="industry-efficiencies-and-a-new-resource-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#industry-efficiencies-and-a-new-resource-matrix" class="anchor"></a>Industry efficiencies and a new resource matrix</h3>
<p>The baseline <span class="math inline">\({\mathbf{R}}\)</span> matrix is shown above. We can calculate the efficiency of every Industry in the ECC using the <code><a href="../reference/calc_eta_i.html">calc_eta_i()</a></code> function. Let’s say we want to estimate the effect of a 50 % reduction in the production rate of crude oil. So, we cut <code>Resources - Crude</code> in half. To execute this reduction, we’ll use the <code><a href="https://www.rdocumentation.org/packages/matsbyname/topics/elementapply_byname">matsbyname::elementapply_byname()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">half &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  x<span class="op">/</span><span class="dv">2</span>
}
HalfCrude &lt;-<span class="st"> </span>IO_mats <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/calc_eta_i.html">calc_eta_i</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="dt">R_prime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/elementapply_byname">elementapply_byname</a></span>(half, <span class="dt">a =</span> R, <span class="dt">row =</span> <span class="st">"Resources - Crude"</span>, <span class="dt">col =</span> <span class="st">"Crude"</span>)
  )
HalfCrude<span class="op">$</span>R_prime[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/clean_byname">clean_byname</a></span>()
<span class="co">#&gt;                   Crude    NG</span>
<span class="co">#&gt; Resources - Crude 25000     0</span>
<span class="co">#&gt; Resources - NG        0 43000</span>
<span class="co">#&gt; attr(,"rowtype")</span>
<span class="co">#&gt; [1] "Industry"</span>
<span class="co">#&gt; attr(,"coltype")</span>
<span class="co">#&gt; [1] "Product"</span></code></pre></div>
<p>Now we use the <code>new_R()</code> function to estimate changes in the ECC. But we need to calculate the efficiency of all sectors in the ECC first using the <code><a href="../reference/calc_eta_i.html">calc_eta_i()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HalfCrude &lt;-<span class="st"> </span>HalfCrude <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/new_R_ps.html">new_R_ps</a></span>()
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(HalfCrude)
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 28</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GB"</span>
<span class="co">#&gt; $ Year        &lt;int&gt; 2000</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E.ktoe"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "final"</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ U           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ R_plus_V    &lt;list&gt; [&lt;matrix[11 x 12]&gt;]</span>
<span class="co">#&gt; $ Y           &lt;list&gt; [&lt;matrix[4 x 2]&gt;]</span>
<span class="co">#&gt; $ R           &lt;list&gt; [&lt;matrix[2 x 12]&gt;]</span>
<span class="co">#&gt; $ V           &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ y           &lt;list&gt; [&lt;matrix[4 x 1]&gt;]</span>
<span class="co">#&gt; $ q           &lt;list&gt; [&lt;matrix[12 x 1]&gt;]</span>
<span class="co">#&gt; $ f           &lt;list&gt; [&lt;matrix[9 x 1]&gt;]</span>
<span class="co">#&gt; $ g           &lt;list&gt; [&lt;matrix[9 x 1]&gt;]</span>
<span class="co">#&gt; $ W           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ Z           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ K           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ C           &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ D           &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ A           &lt;list&gt; [&lt;matrix[12 x 12]&gt;]</span>
<span class="co">#&gt; $ L_pxp       &lt;list&gt; [&lt;matrix[12 x 12]&gt;]</span>
<span class="co">#&gt; $ L_ixp       &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ eta_i       &lt;list&gt; [&lt;matrix[9 x 1]&gt;]</span>
<span class="co">#&gt; $ R_prime     &lt;list&gt; [&lt;matrix[2 x 12]&gt;]</span>
<span class="co">#&gt; $ U_prime     &lt;list&gt; [&lt;matrix[12 x 9]&gt;]</span>
<span class="co">#&gt; $ V_prime     &lt;list&gt; [&lt;matrix[9 x 12]&gt;]</span>
<span class="co">#&gt; $ Y_prime     &lt;list&gt; [&lt;matrix[12 x 2]&gt;]</span></code></pre></div>
<p>After re-calculating the <code>HalfCrude</code> ECC (specifically, after calculating <code>U_prime</code>, <code>V_prime</code>, and <code>Y_prime</code>), we can visualize the effect of lower crude oil availability with a modified Sankey diagram.</p>
<p>First, we have the original Sankey diagram.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(UKEnergyMatsWithR) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Extracts the "Sankey" column</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="co"># Extracts the first row of the "Sankey" column</span></code></pre></div>
<div id="htmlwidget-703c8eebdffdb0c43b84" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-703c8eebdffdb0c43b84">{"x":{"links":{"source":[0,1,1,2,2,3,3,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,7,8,8,9,9,3,10,10,1,4,6,9,8,2,3,10,5],"target":[2,1,3,1,2,4,3,1,4,9,8,2,10,11,6,1,9,8,2,3,5,12,9,5,12,9,8,10,10,11,13,13,13,13,13,13,13,13,13],"value":[50000,500,47000,47500,2500,15500,5000,25,350,50,25,50,250,14750,6400,25,25,25,25,75,100,6000,43000,16000,25000,2000,41000,26500,500,26000,550,350,125,2075,50,2575,5075,750,9700]},"nodes":{"name":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"],"group":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>And here is the modified Sankey diagram showing the much smaller <code>Resources - Crude</code> extraction rate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(HalfCrude, <span class="dt">R =</span> <span class="st">"R_prime"</span>, <span class="dt">U =</span> <span class="st">"U_prime"</span>, <span class="dt">V =</span> <span class="st">"V_prime"</span>, <span class="dt">Y =</span> <span class="st">"Y_prime"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Extracts the "Sankey" column</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="co"># Extracts the first row of the "Sankey" column</span></code></pre></div>
<div id="htmlwidget-a275a8c83831de889970" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-a275a8c83831de889970">{"x":{"links":{"source":[0,1,1,2,2,3,3,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,7,8,8,9,9,3,10,10,1,4,6,9,8,2,3,10,5],"target":[2,1,3,1,2,4,3,1,4,9,8,2,10,11,6,1,9,8,2,3,5,12,9,5,12,9,8,10,10,11,13,13,13,13,13,13,13,13,13],"value":[25000,250.256665815559,23524.1265866625,23761.8982993485,1250.6262262815,7770.26947846955,2506.53854144179,12.532692707209,175.457697900925,25.0653854144179,12.532692707209,25.0653854144179,125.32692707209,7394.28869725328,6394.34931301765,24.9779270039752,24.9779270039752,24.9779270039752,24.9779270039752,74.9337810119256,99.9117080159008,5994.70248095405,43000,15985.8732825441,24977.9270039752,1998.84124491786,40976.2455208161,13284.6542696415,250.653854144179,13034.0004154973,275.282332397112,175.457697900925,124.889635019876,2073.79779160229,49.9558540079548,1288.14501306994,2544.13661956342,375.980781216266,9691.43567754238]},"nodes":{"name":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"],"group":["Resources - Crude","Crude dist.","Oil fields","Oil refineries","Diesel dist.","Power plants","Elect. grid","Resources - NG","NG dist.","Gas wells & proc.","Petrol dist.","Transport","Residential","Waste"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>Note that both ECCs are in complete energy balance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UKEnergyMatsWithR <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/verify_SUT_energy_balance_with_units.html">verify_SUT_energy_balance_with_units</a></span>(<span class="dt">S_units =</span> <span class="st">"S_units"</span>, <span class="dt">U =</span> <span class="st">"U"</span>, <span class="dt">V =</span> <span class="st">"R_plus_V"</span>, <span class="dt">Y =</span> <span class="st">"Y"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Country, Year, Energy.type, Last.stage, .SUT_prod_energy_balance, .SUT_ind_energy_balance)
<span class="co">#&gt;   Country Year Energy.type Last.stage .SUT_prod_energy_balance</span>
<span class="co">#&gt; 1      GB 2000      E.ktoe      final                     TRUE</span>
<span class="co">#&gt;   .SUT_ind_energy_balance</span>
<span class="co">#&gt; 1                    TRUE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HalfCrude <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(K)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="dt">R_plus_V_prime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/sum_byname">sum_byname</a></span>(R_prime, V_prime)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/verify_SUT_energy_balance.html">verify_SUT_energy_balance</a></span>(<span class="dt">U =</span> <span class="st">"U_prime"</span>, <span class="dt">V =</span> <span class="st">"R_plus_V_prime"</span>, <span class="dt">Y =</span> <span class="st">"Y_prime"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Country, Year, Energy.type, Last.stage, .SUT_energy_balance)
<span class="co">#&gt;   Country Year Energy.type Last.stage .SUT_energy_balance</span>
<span class="co">#&gt; 1      GB 2000      E.ktoe      final                TRUE</span></code></pre></div>
<p>The Sankey diagram clearly shows that reducing the availability of crude oil (<code>Resources - crude</code>) means that less <code>Transport</code> final demand can be satisfied.</p>
</div>
</div>
<div id="what-if-perfectly-substitutable-inputs-to-an-intermediate-industry-change-function-new_k_ps" class="section level2">
<h2 class="hasAnchor">
<a href="#what-if-perfectly-substitutable-inputs-to-an-intermediate-industry-change-function-new_k_ps" class="anchor"></a>What if perfectly-substitutable inputs to an intermediate industry change? Function new_k_ps()</h2>
<p><code><a href="../reference/new_Y.html">new_Y()</a></code> estimates the upstream effects of a change in final demand. <code><a href="../reference/new_R_ps.html">new_R_ps()</a></code> estimates the downstream effects of a change in resource availability. But what if we want to estimate the effects of a change to the inputs of an intermediate industry? If those inputs are perfectly substitutable, the <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> function provides an answer.</p>
<p>To demonstrate <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code>, we’ll create a very simple energy conversion chain. (The <code>UKEnergyMatsWithR</code> ECC doesn’t have the characteristic that we need, namely that an intermediate industry has at least two reasonable-sized inputs.) This ECC has two resource industries (R1 and R2), one intermediate industry (I), and two final demand sectors (Y1 and Y2). The R1 industry makes product R1p.<br>
The R2 industry makes product R2p. Industry I makes product Ip. Product Ip is consumed by final demand sectors Y1 and Y2.</p>
<p>The use (U), make (V), final demand (Y), and unit summation (S_units) matrices are given below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">U &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>,
              <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>,
              <span class="dv">0</span>, <span class="dv">0</span>,  <span class="dv">0</span>),
            <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>,
            <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1"</span>, <span class="st">"R2"</span>, <span class="st">"I"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setrowtype">setrowtype</a></span>(<span class="st">"Products"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setcoltype">setcoltype</a></span>(<span class="st">"Industries"</span>)

V &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>,  <span class="dv">0</span>, <span class="dv">0</span>,
               <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">0</span>, 
               <span class="dv">0</span>,  <span class="dv">0</span>, <span class="dv">4</span>), 
            <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, 
            <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1"</span>, <span class="st">"R2"</span>, <span class="st">"I"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setrowtype">setrowtype</a></span>(<span class="st">"Industries"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setcoltype">setcoltype</a></span>(<span class="st">"Products"</span>)

Y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">0</span>, <span class="dv">0</span>, 
              <span class="dv">2</span>, <span class="dv">2</span>),
            <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">2</span>,
            <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Y1"</span>, <span class="st">"Y2"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setrowtype">setrowtype</a></span>(<span class="st">"Products"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setcoltype">setcoltype</a></span>(<span class="st">"Industries"</span>)

S_units &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, 
                    <span class="dv">1</span>, 
                    <span class="dv">1</span>), 
                  <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">1</span>,
                  <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"quad"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setrowtype">setrowtype</a></span>(<span class="st">"Products"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setcoltype">setcoltype</a></span>(<span class="st">"Units"</span>)</code></pre></div>
<p>The Sankey diagram for this simple ECC is given below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(<span class="dt">U =</span> U, <span class="dt">V =</span> V, <span class="dt">Y =</span> Y) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>)</code></pre></div>
<div id="htmlwidget-3e85853a6089baa28ce5" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-3e85853a6089baa28ce5">{"x":{"links":{"source":[0,0,1,2],"target":[3,4,0,0],"value":[2,2,10,10]},"nodes":{"name":["I","R1","R2","Y1","Y2"],"group":["I","R1","R2","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>We can change the proportion of inputs to industry I using <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code>. To do so, we must first calculate the input-output structure of the ECC using the <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code> function. Then, we call the <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> function with a new k vector that indicates industry I now uses 75/25 mixture of <code>R1</code> and <code>R2</code> instead of a 50/50 split between <code>R1</code> and <code>R2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simple_iomats &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_io_mats.html">calc_io_mats</a></span>(<span class="dt">U =</span> U, <span class="dt">V =</span> V, <span class="dt">Y =</span> Y, <span class="dt">S_units =</span> S_units)
k_prime &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.75</span>,
                    <span class="fl">0.25</span>), 
                  <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">1</span>,
                  <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"R1p"</span>, <span class="st">"R2p"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"I"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setrowtype">setrowtype</a></span>(<span class="st">"Products"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matsbyname/topics/setcoltype">setcoltype</a></span>(<span class="st">"Industries"</span>)
change_input_proportions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_k_ps.html">new_k_ps</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(simple_iomats, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">U =</span> U, <span class="dt">V =</span> V, <span class="dt">Y =</span> Y, <span class="dt">S_units =</span> S_units, 
                                                    <span class="dt">k_prime =</span> k_prime)))
<span class="kw"><a href="../reference/make_sankey.html">make_sankey</a></span>(<span class="dt">U =</span> change_input_proportions<span class="op">$</span>U_prime, <span class="dt">V =</span> change_input_proportions<span class="op">$</span>V_prime, <span class="dt">Y =</span> Y) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"Sankey"</span>)</code></pre></div>
<div id="htmlwidget-b5ef6a8488cf8cf3eb5f" style="width:672px;height:384px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-b5ef6a8488cf8cf3eb5f">{"x":{"links":{"source":[0,0,1,2],"target":[3,4,0,0],"value":[2,2,15,5]},"nodes":{"name":["I","R1","R2","Y1","Y2"],"group":["I","R1","R2","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":20,"fontFamily":null,"nodeWidth":15,"nodePadding":14,"units":"Quads","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":500,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>If there were additional upstream industries, they would also change in response to the new ratio of inputs to industry <code>I</code>. The rate of resource extraction needed to supply <code>R1</code> would grow. The rate of resource extraction needed to supply <code>R2</code> would shrink.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p><code>Recca</code> has three functions that allow an analyst to estimate the effect of changes to an ECC.</p>
<ul>
<li>
<code><a href="../reference/new_Y.html">new_Y()</a></code> estimates changes upstream of final demand.</li>
<li>
<code><a href="../reference/new_R_ps.html">new_R_ps()</a></code> estimates changes downstream from resource extraction.</li>
<li>
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> estimates changes upstream of inputs to an intermediate industry.</li>
</ul>
<p>The first of these functions (<code><a href="../reference/new_Y.html">new_Y()</a></code>) was demonstrated in <a href="https://doi.org/10.1016/j.apenergy.2018.05.109">Heun et al. <span class="citation">(2018)</span></a>. The second and third functions (<code><a href="../reference/new_R_ps.html">new_R_ps()</a></code> and <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code>) are shown here for the first time.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Heun:2018">
<p>Heun, Matthew Kuperus, Anne Owen, and Paul E. Brockway. 2018. “A Physical Supply-Use Table Framework for Energy Analysis on the Energy Conversion Chain.” <em>Applied Energy</em> 226 (September): 1134–62. doi:<a href="https://doi.org/10.1016/j.apenergy.2018.05.109">10.1016/j.apenergy.2018.05.109</a>.</p>
</div>
<div id="ref-Leontief:1941">
<p>Leontief, Wassily W. 1941. <em>The Structure of American Economy, 1919-1929: An Empirical Application of Equilibrium Analysis</em>. Cambridge, Massachusetts: Harvard University Press.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#inputs-to-new_-functions">Inputs to <code>new_*</code> functions</a></li>
      <li><a href="#what-if-final-demand-changes-function-new_y">What if final demand changes? Function new_Y()</a></li>
      <li><a href="#what-if-resources-change-function-new_r_ps">What if resources change? Function new_R_ps()</a></li>
      <li><a href="#what-if-perfectly-substitutable-inputs-to-an-intermediate-industry-change-function-new_k_ps">What if perfectly-substitutable inputs to an intermediate industry change? Function new_k_ps()</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
