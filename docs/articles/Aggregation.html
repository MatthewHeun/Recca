<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Recca">
<title>Aggregation • Recca</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregation">
<meta property="og:description" content="Recca">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Recca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.50</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/Recca.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Aggregation.html">Aggregation</a>
    <a class="dropdown-item" href="../articles/new-function-interaction.html">new_* function interactions</a>
    <a class="dropdown-item" href="../articles/new-functions.html">new_* functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MatthewHeun/Recca/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Aggregation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/Recca/blob/HEAD/vignettes/Aggregation.Rmd" class="external-link"><code>vignettes/Aggregation.Rmd</code></a></small>
      <div class="d-none name"><code>Aggregation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>Recca</code> (<code>R</code> Energy Conversion Chain Analysis)
contains many functions useful for aggregating industries and products
in energy conversion chains.</p>
<p>The types of aggregation are shown in the following table.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="79%">
</colgroup>
<thead><tr class="header">
<th align="right">Function</th>
<th align="left">Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right"><code><a href="../reference/primary_aggregates.html">primary_aggregates()</a></code></td>
<td align="left">Aggregates primary energy</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/finaldemand_aggregates.html">finaldemand_aggregates()</a></code></td>
<td align="left">Aggregates final demand energy, the last stage in an
energy conversion chain (ECC)</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/region_aggregates.html">region_aggregates()</a></code></td>
<td align="left">Aggregates regions</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/despecified_aggregates.html">despecified_aggregates()</a></code></td>
<td align="left">Despecifies industries and products, then
aggregates</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/grouped_aggregates.html">grouped_aggregates()</a></code></td>
<td align="left">Groups industries and products, then aggregates</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/pfu_aggregates.html">pfu_aggregates()</a></code></td>
<td align="left">Aggregates to primary, final, and useful stages of an
ECC</td>
</tr>
</tbody>
</table>
<p>This vignette describes those functions and demonstrates their
use.</p>
</div>
<div class="section level2">
<h2 id="primary_aggregates">
<code>primary_aggregates()</code><a class="anchor" aria-label="anchor" href="#primary_aggregates"></a>
</h2>
<p><code><a href="../reference/primary_aggregates.html">primary_aggregates()</a></code> creates a column of primary energy
sums coming from the industries specified in the
<code>p_industries</code> (primary industries) argument. These primary
industries are often found in the <strong>R</strong>,
<strong>V</strong>, and <strong>Y</strong> matrices of the PSUT
framework. Typical <code>p_industries</code> are Resources, Imports, and
Exports. In the examples below, primary aggregates are calculated for
the four rows of the <code>UKEnergy2000mats</code> data frame.</p>
<p>In the first example, only one aggregate column is created (“EX.p”),
because there is no difference between net and gross aggregation for
primary energy. Net and gross primary aggregates are identical.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthewHeun/matsbyname" class="external-link">matsbyname</a></span><span class="op">)</span></span>
<span><span class="va">p_industries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Resources [of Crude]"</span>, <span class="st">"Resources [of NG]"</span><span class="op">)</span></span>
<span><span class="co"># Calculate primary total aggregates</span></span>
<span><span class="va">ECCs</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000mats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"matrix.name"</span>, values_from <span class="op">=</span> <span class="st">"matrix"</span><span class="op">)</span></span>
<span><span class="va">ECCs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   Country  Year Energy.type Last.stage R             U        U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Final      <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Useful     <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GBR      <span style="text-decoration: underline;">2</span>000 X           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: V &lt;list&gt;, Y &lt;list&gt;, r_EIOU &lt;list&gt;, S_units &lt;list&gt;</span></span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">Recca</span><span class="fu">::</span><span class="fu"><a href="../reference/primary_aggregates.html">primary_aggregates</a></span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>, by <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 13</span></span></span>
<span><span class="co">#&gt;   Country  Year Energy.type Last.stage R             U        U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Final      <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Useful     <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GBR      <span style="text-decoration: underline;">2</span>000 X           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: V &lt;list&gt;, Y &lt;list&gt;, r_EIOU &lt;list&gt;, S_units &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   EX.p &lt;dbl&gt;</span></span></span>
<span><span class="va">res</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">aggregate_primary</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 93000 93000 93000 98220</span></span></code></pre></div>
<p>In the next example, both net and gross aggregation columns are
created (“EX.p_net” and “EX.p_gross”), for compatibility with the
<code><a href="../reference/finaldemand_aggregates.html">finaldemand_aggregates()</a></code> function discussed below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">Recca</span><span class="fu">::</span><span class="fu"><a href="../reference/primary_aggregates.html">primary_aggregates</a></span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>,</span>
<span>                            add_net_gross_cols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            by <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 14</span></span></span>
<span><span class="co">#&gt;   Country  Year Energy.type Last.stage R             U        U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Final      <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Useful     <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GBR      <span style="text-decoration: underline;">2</span>000 X           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: V &lt;list&gt;, Y &lt;list&gt;, r_EIOU &lt;list&gt;, S_units &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   EX.p_net &lt;dbl&gt;, EX.p_gross &lt;dbl&gt;</span></span></span>
<span><span class="va">res2</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_primary</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 93000 93000 93000 98220</span></span>
<span><span class="va">res2</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_primary</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 93000 93000 93000 98220</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="finaldemand_aggregates">
<code>finaldemand_aggregates()</code><a class="anchor" aria-label="anchor" href="#finaldemand_aggregates"></a>
</h2>
<p><code><a href="../reference/finaldemand_aggregates.html">finaldemand_aggregates()</a></code> is similar to
<code><a href="../reference/primary_aggregates.html">primary_aggregates()</a></code>, except that it aggregates energy at
the final demand stage in the <strong>Y</strong> matrix. Both net and
gross aggregate final demand are calculated. Gross final demand includes
energy industry own use (EIOU). Net final demand does not.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fd_sectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Residential"</span>, <span class="st">"Transport"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">Recca</span><span class="fu">::</span><span class="fu"><a href="../reference/finaldemand_aggregates.html">finaldemand_aggregates</a></span><span class="op">(</span>fd_sectors <span class="op">=</span> <span class="va">fd_sectors</span>, by <span class="op">=</span> <span class="st">"Sector"</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 14</span></span></span>
<span><span class="co">#&gt;   Country  Year Energy.type Last.stage R             U        U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Final      <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GBR      <span style="text-decoration: underline;">2</span>000 E           Useful     <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GBR      <span style="text-decoration: underline;">2</span>000 X           Services   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: V &lt;list&gt;, Y &lt;list&gt;, r_EIOU &lt;list&gt;, S_units &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   EX.fd_net &lt;list&gt;, EX.fd_gross &lt;list&gt;</span></span></span>
<span><span class="va">res</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_demand</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;             Product</span></span>
<span><span class="co">#&gt; Residential   31000</span></span>
<span><span class="co">#&gt; Transport     40750</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;                  Product</span></span>
<span><span class="co">#&gt; Residential 5.000750e+14</span></span>
<span><span class="co">#&gt; Transport   6.429166e+11</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;              Product</span></span>
<span><span class="co">#&gt; Residential  4200.40</span></span>
<span><span class="co">#&gt; Transport   21714.98</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;                  Product</span></span>
<span><span class="co">#&gt; Residential 5.000750e+14</span></span>
<span><span class="co">#&gt; Transport   6.429166e+11</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="va">res</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_demand</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;             Product</span></span>
<span><span class="co">#&gt; Residential   31000</span></span>
<span><span class="co">#&gt; Transport     40750</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;                  Product</span></span>
<span><span class="co">#&gt; Residential 5.000750e+14</span></span>
<span><span class="co">#&gt; Transport   6.429166e+11</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;              Product</span></span>
<span><span class="co">#&gt; Residential  4200.40</span></span>
<span><span class="co">#&gt; Transport   21714.98</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;                  Product</span></span>
<span><span class="co">#&gt; Residential 5.000750e+14</span></span>
<span><span class="co">#&gt; Transport   6.429166e+11</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="region_aggregates">
<code>region_aggregates()</code><a class="anchor" aria-label="anchor" href="#region_aggregates"></a>
</h2>
<p><code><a href="../reference/region_aggregates.html">region_aggregates()</a></code> sums regions according to
<code>many_colname</code> and <code>few_colname</code>. To demonstrate
this function, we need to modify the The example data frame slightly. It
contains only one country (“GBR”), but it should contain different
countries and a “few” column. Furthermore, the last stage and energy
type columns should be the same where aggregation is required. The
following code produces this modification to pretend that rows of the
data frame apply to different countries.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ECCs_for_region_agg</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"GBR"</span>, <span class="st">"CAN"</span>, <span class="st">"FRA"</span><span class="op">)</span>, </span>
<span>    Continent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NoAmr"</span>, <span class="st">"Europe"</span>, <span class="st">"NoAmr"</span>, <span class="st">"Europe"</span><span class="op">)</span>, </span>
<span>    Energy.type <span class="op">=</span> <span class="st">"E"</span>, </span>
<span>    Last.stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Final"</span>, <span class="st">"Services"</span>, <span class="st">"Final"</span>, <span class="st">"Services"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ECCs_for_region_agg</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Continent</span>, <span class="va">Energy.type</span>, <span class="va">Last.stage</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt;   Country Continent Energy.type Last.stage</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> USA     NoAmr     E           Final     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GBR     Europe    E           Services  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> CAN     NoAmr     E           Final     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> FRA     Europe    E           Services</span></span></code></pre></div>
<p>Given this modification, we aggregate to continents with the
following code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continent_aggregations</span> <span class="op">&lt;-</span> <span class="va">ECCs_for_region_agg</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">Recca</span><span class="fu">::</span><span class="fu"><a href="../reference/region_aggregates.html">region_aggregates</a></span><span class="op">(</span>many_colname <span class="op">=</span> <span class="st">"Country"</span>, few_colname <span class="op">=</span> <span class="st">"Continent"</span><span class="op">)</span></span>
<span><span class="va">continent_aggregations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 12</span></span></span>
<span><span class="co">#&gt;    Year Energy.type Last.stage Country R             S_units  U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 E           Final      NoAmr   <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 E           Services   Europe  <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: V &lt;list&gt;, Y &lt;list&gt;, U &lt;list&gt;, r_EIOU &lt;list&gt;</span></span></span></code></pre></div>
<p>By default, <code>many_colname</code> is replaced by the common
values in <code>few_colname</code>. A simple rename can override this
default behaviour.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continent_aggregations</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    Continent <span class="op">=</span> <span class="va">Country</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 12</span></span></span>
<span><span class="co">#&gt;    Year Energy.type Last.stage Continent R        S_units  U_EIOU   U_feed  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 E           Final      NoAmr     <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 E           Services   Europe    <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span> <span style="color: #949494;">&lt;dbl[…]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: V &lt;list&gt;, Y &lt;list&gt;, U &lt;list&gt;, r_EIOU &lt;list&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="despecified_aggregates">
<code>despecified_aggregates()</code><a class="anchor" aria-label="anchor" href="#despecified_aggregates"></a>
</h2>
<p>When the row and column names of the PSUT matrices are “specified,”
they will look like “Resources [of Crude]” or “NG [from Wells]”. Many
labels can have a “noun [preposition object]” structure, which we call
“specified.” <code><a href="../reference/despecified_aggregates.html">despecified_aggregates()</a></code> eliminates the
specification in the row and/or column names, keeping the desired
<code>piece</code> (by default the “noun”), and aggregates (sums) rows
or columns with resulting identical names. See the comments in the
examples below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">despecified_aggs</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Accept the default "noun" aggregation</span></span>
<span>  <span class="co"># and the default "_aggregated" suffix for </span></span>
<span>  <span class="co"># aggregated columns.</span></span>
<span>  <span class="fu"><a href="../reference/despecified_aggregates.html">despecified_aggregates</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is the original R matrix.</span></span>
<span><span class="co"># Its row names are specified.</span></span>
<span><span class="va">ECCs</span><span class="op">$</span><span class="va">R</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                      Crude    NG</span></span>
<span><span class="co">#&gt; Resources [of Crude] 50000     0</span></span>
<span><span class="co">#&gt; Resources [of NG]        0 43000</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span></span>
<span><span class="co"># This is the despecified R matrix.</span></span>
<span><span class="co"># Note the single Resources row.</span></span>
<span><span class="va">despecified_aggs</span><span class="op">$</span><span class="va">R_aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;           Crude    NG</span></span>
<span><span class="co">#&gt; Resources 50000 43000</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span></span>
<span><span class="co"># Here is an original use matrix.</span></span>
<span><span class="co"># Many rows are specified.</span></span>
<span><span class="va">ECCs</span><span class="op">$</span><span class="va">U</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                         Car engines   Cars Crude dist. Diesel dist. Elect. grid</span></span>
<span><span class="co">#&gt; Crude                             0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; Crude [from Dist.]                0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; Crude [from Fields]               0    0.0       47500     0.00e+00           0</span></span>
<span><span class="co">#&gt; Diesel                            0    0.0           0     1.55e+04           0</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]               0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; Elect                             0    0.0           0     0.00e+00        6400</span></span>
<span><span class="co">#&gt; Elect [from Grid]                 0    0.0          25     0.00e+00           0</span></span>
<span><span class="co">#&gt; Freight [tonne-km/year]           0    0.0  1666685185     1.50e+09           0</span></span>
<span><span class="co">#&gt; Light                             0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; LTH                               0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; MD [from Car engines]             0 3000.4           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; MD [from Truck engines]           0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; NG                                0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; NG [from Dist.]                   0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; NG [from Wells]                   0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; Petrol                            0    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]           26000    0.0           0     0.00e+00           0</span></span>
<span><span class="co">#&gt;                         Furnaces Gas wells &amp; proc. Homes Light fixtures</span></span>
<span><span class="co">#&gt; Crude                          0                 0     0              0</span></span>
<span><span class="co">#&gt; Crude [from Dist.]             0                 0     0              0</span></span>
<span><span class="co">#&gt; Crude [from Fields]            0                 0     0              0</span></span>
<span><span class="co">#&gt; Diesel                         0                 0     0              0</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]            0                50     0              0</span></span>
<span><span class="co">#&gt; Elect                          0                 0     0              0</span></span>
<span><span class="co">#&gt; Elect [from Grid]              0                25     0           6000</span></span>
<span><span class="co">#&gt; Freight [tonne-km/year]        0                 0     0              0</span></span>
<span><span class="co">#&gt; Light                          0                 0     0              0</span></span>
<span><span class="co">#&gt; LTH                            0                 0 20000              0</span></span>
<span><span class="co">#&gt; MD [from Car engines]          0                 0     0              0</span></span>
<span><span class="co">#&gt; MD [from Truck engines]        0                 0     0              0</span></span>
<span><span class="co">#&gt; NG                             0             43000     0              0</span></span>
<span><span class="co">#&gt; NG [from Dist.]            25000                 0     0              0</span></span>
<span><span class="co">#&gt; NG [from Wells]                0                 0     0              0</span></span>
<span><span class="co">#&gt; Petrol                         0                 0     0              0</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]            0                 0     0              0</span></span>
<span><span class="co">#&gt;                           NG dist. Oil fields Oil refineries Petrol dist.</span></span>
<span><span class="co">#&gt; Crude                            0      50000              0     0.00e+00</span></span>
<span><span class="co">#&gt; Crude [from Dist.]               0          0          47000     0.00e+00</span></span>
<span><span class="co">#&gt; Crude [from Fields]              0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; Diesel                           0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]              0         50              0     0.00e+00</span></span>
<span><span class="co">#&gt; Elect                            0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; Elect [from Grid]               25         25             75     0.00e+00</span></span>
<span><span class="co">#&gt; Freight [tonne-km/year] 1666685185          0              0     2.25e+09</span></span>
<span><span class="co">#&gt; Light                            0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; LTH                              0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; MD [from Car engines]            0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; MD [from Truck engines]          0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; NG                               0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; NG [from Dist.]                  0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; NG [from Wells]              41000          0              0     0.00e+00</span></span>
<span><span class="co">#&gt; Petrol                           0          0              0     2.65e+04</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]              0          0              0     0.00e+00</span></span>
<span><span class="co">#&gt;                         Power plants Rooms Truck engines  Trucks</span></span>
<span><span class="co">#&gt; Crude                              0     0             0    0.00</span></span>
<span><span class="co">#&gt; Crude [from Dist.]                 0     0             0    0.00</span></span>
<span><span class="co">#&gt; Crude [from Fields]                0     0             0    0.00</span></span>
<span><span class="co">#&gt; Diesel                             0     0             0    0.00</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]                0     0         15050    0.00</span></span>
<span><span class="co">#&gt; Elect                              0     0             0    0.00</span></span>
<span><span class="co">#&gt; Elect [from Grid]                100     0             0    0.00</span></span>
<span><span class="co">#&gt; Freight [tonne-km/year]            0     0             0    0.00</span></span>
<span><span class="co">#&gt; Light                              0  1200             0    0.00</span></span>
<span><span class="co">#&gt; LTH                                0     0             0    0.00</span></span>
<span><span class="co">#&gt; MD [from Car engines]              0     0             0    0.00</span></span>
<span><span class="co">#&gt; MD [from Truck engines]            0     0             0 1799.98</span></span>
<span><span class="co">#&gt; NG                                 0     0             0    0.00</span></span>
<span><span class="co">#&gt; NG [from Dist.]                16000     0             0    0.00</span></span>
<span><span class="co">#&gt; NG [from Wells]                    0     0             0    0.00</span></span>
<span><span class="co">#&gt; Petrol                             0     0             0    0.00</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]                0     0             0    0.00</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span></span>
<span><span class="co"># Here is the corresponding despecified use matrix. </span></span>
<span><span class="co"># None of the rows are specified.</span></span>
<span><span class="va">despecified_aggs</span><span class="op">$</span><span class="va">U_aggregated</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;         Car engines   Cars Crude dist Diesel dist Elect Furnaces</span></span>
<span><span class="co">#&gt; Crude             0    0.0      47500    0.00e+00     0        0</span></span>
<span><span class="co">#&gt; Diesel            0    0.0          0    1.55e+04     0        0</span></span>
<span><span class="co">#&gt; Elect             0    0.0         25    0.00e+00  6400        0</span></span>
<span><span class="co">#&gt; Freight           0    0.0 1666685185    1.50e+09     0        0</span></span>
<span><span class="co">#&gt; Light             0    0.0          0    0.00e+00     0        0</span></span>
<span><span class="co">#&gt; LTH               0    0.0          0    0.00e+00     0        0</span></span>
<span><span class="co">#&gt; MD                0 3000.4          0    0.00e+00     0        0</span></span>
<span><span class="co">#&gt; NG                0    0.0          0    0.00e+00     0    25000</span></span>
<span><span class="co">#&gt; Petrol        26000    0.0          0    0.00e+00     0        0</span></span>
<span><span class="co">#&gt;         Gas wells &amp; proc Homes Light fixtures    NG dist Oil fields</span></span>
<span><span class="co">#&gt; Crude                  0     0              0          0      50000</span></span>
<span><span class="co">#&gt; Diesel                50     0              0          0         50</span></span>
<span><span class="co">#&gt; Elect                 25     0           6000         25         25</span></span>
<span><span class="co">#&gt; Freight                0     0              0 1666685185          0</span></span>
<span><span class="co">#&gt; Light                  0     0              0          0          0</span></span>
<span><span class="co">#&gt; LTH                    0 20000              0          0          0</span></span>
<span><span class="co">#&gt; MD                     0     0              0          0          0</span></span>
<span><span class="co">#&gt; NG                 43000     0              0      41000          0</span></span>
<span><span class="co">#&gt; Petrol                 0     0              0          0          0</span></span>
<span><span class="co">#&gt;         Oil refineries Petrol dist Power plants Rooms Truck engines  Trucks</span></span>
<span><span class="co">#&gt; Crude            47000    0.00e+00            0     0             0    0.00</span></span>
<span><span class="co">#&gt; Diesel               0    0.00e+00            0     0         15050    0.00</span></span>
<span><span class="co">#&gt; Elect               75    0.00e+00          100     0             0    0.00</span></span>
<span><span class="co">#&gt; Freight              0    2.25e+09            0     0             0    0.00</span></span>
<span><span class="co">#&gt; Light                0    0.00e+00            0  1200             0    0.00</span></span>
<span><span class="co">#&gt; LTH                  0    0.00e+00            0     0             0    0.00</span></span>
<span><span class="co">#&gt; MD                   0    0.00e+00            0     0             0 1799.98</span></span>
<span><span class="co">#&gt; NG                   0    0.00e+00        16000     0             0    0.00</span></span>
<span><span class="co">#&gt; Petrol               0    2.65e+04            0     0             0    0.00</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span></span>
<span><span class="co"># Here is an original make matrix</span></span>
<span><span class="co"># with many specified columns.</span></span>
<span><span class="va">ECCs</span><span class="op">$</span><span class="va">V</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                   Crude [from Dist.] Crude [from Fields] Diesel</span></span>
<span><span class="co">#&gt; Car engines                        0                   0      0</span></span>
<span><span class="co">#&gt; Crude dist.                    47000                   0      0</span></span>
<span><span class="co">#&gt; Diesel dist.                       0                   0      0</span></span>
<span><span class="co">#&gt; Elect. grid                        0                   0      0</span></span>
<span><span class="co">#&gt; Furnaces                           0                   0      0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.                  0                   0      0</span></span>
<span><span class="co">#&gt; Light fixtures                     0                   0      0</span></span>
<span><span class="co">#&gt; NG dist.                           0                   0      0</span></span>
<span><span class="co">#&gt; Oil fields                         0               47500      0</span></span>
<span><span class="co">#&gt; Oil refineries                     0                   0  15500</span></span>
<span><span class="co">#&gt; Petrol dist.                       0                   0      0</span></span>
<span><span class="co">#&gt; Power plants                       0                   0      0</span></span>
<span><span class="co">#&gt; Truck engines                      0                   0      0</span></span>
<span><span class="co">#&gt;                   Diesel [from Dist.] Elect Elect [from Grid] Light   LTH</span></span>
<span><span class="co">#&gt; Car engines                         0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Crude dist.                         0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Diesel dist.                    15150     0                 0     0     0</span></span>
<span><span class="co">#&gt; Elect. grid                         0     0              6275     0     0</span></span>
<span><span class="co">#&gt; Furnaces                            0     0                 0     0 20000</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.                   0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Light fixtures                      0     0                 0  1200     0</span></span>
<span><span class="co">#&gt; NG dist.                            0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Oil fields                          0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Oil refineries                      0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Petrol dist.                        0     0                 0     0     0</span></span>
<span><span class="co">#&gt; Power plants                        0  6400                 0     0     0</span></span>
<span><span class="co">#&gt; Truck engines                       0     0                 0     0     0</span></span>
<span><span class="co">#&gt;                   MD [from Car engines] MD [from Truck engines] NG [from Dist.]</span></span>
<span><span class="co">#&gt; Car engines                      3000.4                    0.00               0</span></span>
<span><span class="co">#&gt; Crude dist.                         0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Diesel dist.                        0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Elect. grid                         0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Furnaces                            0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.                   0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Light fixtures                      0.0                    0.00               0</span></span>
<span><span class="co">#&gt; NG dist.                            0.0                    0.00           41000</span></span>
<span><span class="co">#&gt; Oil fields                          0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Oil refineries                      0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Petrol dist.                        0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Power plants                        0.0                    0.00               0</span></span>
<span><span class="co">#&gt; Truck engines                       0.0                 1799.98               0</span></span>
<span><span class="co">#&gt;                   NG [from Wells] Petrol Petrol [from Dist.]</span></span>
<span><span class="co">#&gt; Car engines                     0      0                   0</span></span>
<span><span class="co">#&gt; Crude dist.                     0      0                   0</span></span>
<span><span class="co">#&gt; Diesel dist.                    0      0                   0</span></span>
<span><span class="co">#&gt; Elect. grid                     0      0                   0</span></span>
<span><span class="co">#&gt; Furnaces                        0      0                   0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.           41000      0                   0</span></span>
<span><span class="co">#&gt; Light fixtures                  0      0                   0</span></span>
<span><span class="co">#&gt; NG dist.                        0      0                   0</span></span>
<span><span class="co">#&gt; Oil fields                      0      0                   0</span></span>
<span><span class="co">#&gt; Oil refineries                  0  26500                   0</span></span>
<span><span class="co">#&gt; Petrol dist.                    0      0               26000</span></span>
<span><span class="co">#&gt; Power plants                    0      0                   0</span></span>
<span><span class="co">#&gt; Truck engines                   0      0                   0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span></span>
<span><span class="co"># None of the columns are specified</span></span>
<span><span class="co"># in the despecified version.</span></span>
<span><span class="va">despecified_aggs</span><span class="op">$</span><span class="va">V_aggregated</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                  Crude Diesel Elect Light   LTH      MD    NG Petrol</span></span>
<span><span class="co">#&gt; Car engines          0      0     0     0     0 3000.40     0      0</span></span>
<span><span class="co">#&gt; Crude dist       47000      0     0     0     0    0.00     0      0</span></span>
<span><span class="co">#&gt; Diesel dist          0  15150     0     0     0    0.00     0      0</span></span>
<span><span class="co">#&gt; Elect                0      0  6275     0     0    0.00     0      0</span></span>
<span><span class="co">#&gt; Furnaces             0      0     0     0 20000    0.00     0      0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc     0      0     0     0     0    0.00 41000      0</span></span>
<span><span class="co">#&gt; Light fixtures       0      0     0  1200     0    0.00     0      0</span></span>
<span><span class="co">#&gt; NG dist              0      0     0     0     0    0.00 41000      0</span></span>
<span><span class="co">#&gt; Oil fields       47500      0     0     0     0    0.00     0      0</span></span>
<span><span class="co">#&gt; Oil refineries       0  15500     0     0     0    0.00     0  26500</span></span>
<span><span class="co">#&gt; Petrol dist          0      0     0     0     0    0.00     0  26000</span></span>
<span><span class="co">#&gt; Power plants         0      0  6400     0     0    0.00     0      0</span></span>
<span><span class="co">#&gt; Truck engines        0      0     0     0     0 1799.98     0      0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span></span>
<span><span class="co"># This original final demand matrix</span></span>
<span><span class="co"># has specified rownames</span></span>
<span><span class="co"># that provide units.</span></span>
<span><span class="va">ECCs</span><span class="op">$</span><span class="va">Y</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                             Residential    Transport</span></span>
<span><span class="co">#&gt; Freight [tonne-km/year]         0.0e+00 142916629629</span></span>
<span><span class="co">#&gt; Illumination [lumen-hrs/yr]     5.0e+14            0</span></span>
<span><span class="co">#&gt; Passenger [passenger-km/yr]     0.0e+00 500000000000</span></span>
<span><span class="co">#&gt; Space heating [m3-K]            7.5e+10            0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span></span>
<span><span class="co"># Despecifying this matrix eliminates the units,</span></span>
<span><span class="co"># resulting in information loss.</span></span>
<span><span class="va">despecified_aggs</span><span class="op">$</span><span class="va">Y_aggregated</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;               Residential    Transport</span></span>
<span><span class="co">#&gt; Freight           0.0e+00 142916629629</span></span>
<span><span class="co">#&gt; Illumination      5.0e+14            0</span></span>
<span><span class="co">#&gt; Passenger         0.0e+00 500000000000</span></span>
<span><span class="co">#&gt; Space heating     7.5e+10            0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span></code></pre></div>
<p>As the last example (with the final demand matrix,
<strong>Y</strong>) shows, aggregating despecified row and column names
can lead to information loss. Thus,
<code><a href="../reference/despecified_aggregates.html">despecified_aggregates()</a></code> will normally be called only at
the last step in a calculation chain.</p>
</div>
<div class="section level2">
<h2 id="grouped_aggregates">
<code>grouped_aggregates()</code><a class="anchor" aria-label="anchor" href="#grouped_aggregates"></a>
</h2>
<p>Grouping provides the capability to aggregate specific energy
products to classes of energy and groupings of processing stages or
final demand categories. For example, Anthracite and Brown coal can be
grouped to Coal and coal products. An aggregation map is required.</p>
<p>To demonstrate grouped aggregation, we first establish an aggregation
map. An aggregation map is a named list where list members are
aggregated to member names.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Crude oil` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Crude"</span>, <span class="st">"Crude [from Dist.]"</span>, <span class="st">"Crude [from Fields]"</span><span class="op">)</span>, </span>
<span>                `Oil and oil products` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Diesel"</span>, <span class="st">"Diesel [from Dist.]"</span>, </span>
<span>                                           <span class="st">"Petrol"</span>, <span class="st">"Petrol [from Dist.]"</span><span class="op">)</span>, </span>
<span>                NG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NG"</span>, <span class="st">"NG [from Dist.]"</span>, <span class="st">"NG [from Wells]"</span><span class="op">)</span>,</span>
<span>                Electricity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Elect"</span>, <span class="st">"Elect [from Grid]"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The aggregation map can be used with
<code><a href="../reference/grouped_aggregates.html">grouped_aggregates()</a></code> to do the desired aggregation.
Aggregation columns are added to the right of the <code>.sut_data</code>
data frame.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here is an original use matrix.</span></span>
<span><span class="va">ECCs</span><span class="op">$</span><span class="va">U</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                     Crude dist. Diesel dist. Elect. grid Gas wells &amp; proc.</span></span>
<span><span class="co">#&gt; Crude                         0            0           0                 0</span></span>
<span><span class="co">#&gt; Crude [from Dist.]          500            0           0                 0</span></span>
<span><span class="co">#&gt; Crude [from Fields]       47500            0           0                 0</span></span>
<span><span class="co">#&gt; Diesel                        0        15500           0                 0</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]          25          350           0                50</span></span>
<span><span class="co">#&gt; Elect                         0            0        6400                 0</span></span>
<span><span class="co">#&gt; Elect [from Grid]            25            0           0                25</span></span>
<span><span class="co">#&gt; NG                            0            0           0             43000</span></span>
<span><span class="co">#&gt; NG [from Dist.]               0            0           0                 0</span></span>
<span><span class="co">#&gt; NG [from Wells]               0            0           0              2000</span></span>
<span><span class="co">#&gt; Petrol                        0            0           0                 0</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]           0            0           0                 0</span></span>
<span><span class="co">#&gt;                     NG dist. Oil fields Oil refineries Petrol dist.</span></span>
<span><span class="co">#&gt; Crude                      0      50000              0            0</span></span>
<span><span class="co">#&gt; Crude [from Dist.]         0          0          47000            0</span></span>
<span><span class="co">#&gt; Crude [from Fields]        0       2500              0            0</span></span>
<span><span class="co">#&gt; Diesel                     0          0           5000            0</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]       25         50              0          250</span></span>
<span><span class="co">#&gt; Elect                      0          0              0            0</span></span>
<span><span class="co">#&gt; Elect [from Grid]         25         25             75            0</span></span>
<span><span class="co">#&gt; NG                         0          0              0            0</span></span>
<span><span class="co">#&gt; NG [from Dist.]            0          0              0            0</span></span>
<span><span class="co">#&gt; NG [from Wells]        41000          0              0            0</span></span>
<span><span class="co">#&gt; Petrol                     0          0              0        26500</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]        0          0              0          500</span></span>
<span><span class="co">#&gt;                     Power plants</span></span>
<span><span class="co">#&gt; Crude                          0</span></span>
<span><span class="co">#&gt; Crude [from Dist.]             0</span></span>
<span><span class="co">#&gt; Crude [from Fields]            0</span></span>
<span><span class="co">#&gt; Diesel                         0</span></span>
<span><span class="co">#&gt; Diesel [from Dist.]            0</span></span>
<span><span class="co">#&gt; Elect                          0</span></span>
<span><span class="co">#&gt; Elect [from Grid]            100</span></span>
<span><span class="co">#&gt; NG                             0</span></span>
<span><span class="co">#&gt; NG [from Dist.]            16000</span></span>
<span><span class="co">#&gt; NG [from Wells]                0</span></span>
<span><span class="co">#&gt; Petrol                         0</span></span>
<span><span class="co">#&gt; Petrol [from Dist.]            0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span></span>
<span><span class="co"># Aggregate to the desired groups.</span></span>
<span><span class="va">ECCs_grouped_aggs</span> <span class="op">&lt;-</span> <span class="va">ECCs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grouped_aggregates.html">grouped_aggregates</a></span><span class="op">(</span>aggregation_map <span class="op">=</span> <span class="va">agg_map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here is the aggregated use matrix.</span></span>
<span><span class="co"># Note that the rows are summed</span></span>
<span><span class="co"># and named according to the agg_map.</span></span>
<span><span class="va">ECCs_grouped_aggs</span><span class="op">$</span><span class="va">U_aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                      Crude dist. Diesel dist. Elect. grid Gas wells &amp; proc.</span></span>
<span><span class="co">#&gt; Crude oil                  48000            0           0                 0</span></span>
<span><span class="co">#&gt; Electricity                   25            0        6400                25</span></span>
<span><span class="co">#&gt; NG                             0            0           0             45000</span></span>
<span><span class="co">#&gt; Oil and oil products          25        15850           0                50</span></span>
<span><span class="co">#&gt;                      NG dist. Oil fields Oil refineries Petrol dist.</span></span>
<span><span class="co">#&gt; Crude oil                   0      52500          47000            0</span></span>
<span><span class="co">#&gt; Electricity                25         25             75            0</span></span>
<span><span class="co">#&gt; NG                      41000          0              0            0</span></span>
<span><span class="co">#&gt; Oil and oil products       25         50           5000        27250</span></span>
<span><span class="co">#&gt;                      Power plants</span></span>
<span><span class="co">#&gt; Crude oil                       0</span></span>
<span><span class="co">#&gt; Electricity                   100</span></span>
<span><span class="co">#&gt; NG                          16000</span></span>
<span><span class="co">#&gt; Oil and oil products            0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pfu_aggregates">
<code>pfu_aggregates()</code><a class="anchor" aria-label="anchor" href="#pfu_aggregates"></a>
</h2>
<p>Aggregating to primary, final, and useful stages of the energy
conversion chain (ECC) can be accomplished with
<code><a href="../reference/pfu_aggregates.html">pfu_aggregates()</a></code>. Aggregates are added in columns to the
right of the <code>.sutdata</code> data frame. Primary industries and
final demand sectors are specified as character vectors in the
<code>p_industries</code> and <code>fd_sectors</code> arguments.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the defaul separator for column names</span></span>
<span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="../reference/all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">last_stage_sep</span></span>
<span><span class="co"># Set primary industry names and final demand sector names</span></span>
<span><span class="va">p_industries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Resources [of Crude]"</span>, <span class="st">"Resources [of NG]"</span><span class="op">)</span></span>
<span><span class="va">fd_sectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Residential"</span>, <span class="st">"Transport"</span>, <span class="st">"Oil fields"</span><span class="op">)</span></span>
<span><span class="co"># Calculate TOTAL aggregates</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000mats</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">matrix.name</span>, values_from <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pfu_aggregates.html">pfu_aggregates</a></span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>, fd_sectors <span class="op">=</span> <span class="va">fd_sectors</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span></span>
<span><span class="co"># Look at the column names.</span></span>
<span><span class="co"># The naming scheme is </span></span>
<span><span class="co"># EX.stage.gn___lsStage</span></span>
<span><span class="co"># EX = energy or exergy aggregate (depending on the value in the Energy.type column)</span></span>
<span><span class="co"># stage = the stage at which the aggregation is computed</span></span>
<span><span class="co"># gn = whether the aggregate is "gross" or "net"</span></span>
<span><span class="co"># ____ls = the separator (Recca::all_stages$last_stage_sep)</span></span>
<span><span class="co"># Stage = The last stage in the ECC for this column.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pfu_aggs_total</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Country"                 "Year"                   </span></span>
<span><span class="co">#&gt;  [3] "Energy.type"             "R___lsFinal"            </span></span>
<span><span class="co">#&gt;  [5] "U___lsFinal"             "U_feed___lsFinal"       </span></span>
<span><span class="co">#&gt;  [7] "U_EIOU___lsFinal"        "r_EIOU___lsFinal"       </span></span>
<span><span class="co">#&gt;  [9] "V___lsFinal"             "Y___lsFinal"            </span></span>
<span><span class="co">#&gt; [11] "S_units___lsFinal"       "R___lsUseful"           </span></span>
<span><span class="co">#&gt; [13] "U___lsUseful"            "U_feed___lsUseful"      </span></span>
<span><span class="co">#&gt; [15] "U_EIOU___lsUseful"       "r_EIOU___lsUseful"      </span></span>
<span><span class="co">#&gt; [17] "V___lsUseful"            "Y___lsUseful"           </span></span>
<span><span class="co">#&gt; [19] "S_units___lsUseful"      "R___lsServices"         </span></span>
<span><span class="co">#&gt; [21] "U___lsServices"          "U_feed___lsServices"    </span></span>
<span><span class="co">#&gt; [23] "U_EIOU___lsServices"     "r_EIOU___lsServices"    </span></span>
<span><span class="co">#&gt; [25] "V___lsServices"          "Y___lsServices"         </span></span>
<span><span class="co">#&gt; [27] "S_units___lsServices"    "EX.p_net___lsFinal"     </span></span>
<span><span class="co">#&gt; [29] "EX.p_gross___lsFinal"    "EX.p_net___lsUseful"    </span></span>
<span><span class="co">#&gt; [31] "EX.p_gross___lsUseful"   "EX.p_net___lsServices"  </span></span>
<span><span class="co">#&gt; [33] "EX.p_gross___lsServices" "EX.f_net___lsFinal"     </span></span>
<span><span class="co">#&gt; [35] "EX.f_gross___lsFinal"    "EX.f_net___lsUseful"    </span></span>
<span><span class="co">#&gt; [37] "EX.f_gross___lsUseful"   "EX.f_net___lsServices"  </span></span>
<span><span class="co">#&gt; [39] "EX.f_gross___lsServices" "EX.u_net___lsFinal"     </span></span>
<span><span class="co">#&gt; [41] "EX.u_gross___lsFinal"    "EX.u_net___lsUseful"    </span></span>
<span><span class="co">#&gt; [43] "EX.u_gross___lsUseful"   "EX.u_net___lsServices"  </span></span>
<span><span class="co">#&gt; [45] "EX.u_gross___lsServices" "EX.s_net___lsFinal"     </span></span>
<span><span class="co">#&gt; [47] "EX.s_gross___lsFinal"    "EX.s_net___lsUseful"    </span></span>
<span><span class="co">#&gt; [49] "EX.s_gross___lsUseful"   "EX.s_net___lsServices"  </span></span>
<span><span class="co">#&gt; [51] "EX.s_gross___lsServices"</span></span>
<span><span class="co"># Check some aggregation values.</span></span>
<span><span class="co"># Note that not all aggregations are available, </span></span>
<span><span class="co"># based on the structure of the ECC.</span></span>
<span></span>
<span><span class="co"># Net primary energy aggregation when last stage is Final</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.p_net___lsFinal"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 93000</span></span>
<span><span class="co"># Net primary exergy aggregation when last stage is Services</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"X"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.p_net___lsServices"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 98220</span></span>
<span><span class="co"># Gross final energy aggregation when last stage is Useful</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.f_gross___lsFinal"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 74325</span></span>
<span><span class="co"># Gross useful energy aggregation when last stage is Useful</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.u_gross___lsUseful"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25990.38</span></span>
<span><span class="co"># Net useful energy aggregation when last stage is Useful</span></span>
<span><span class="va">pfu_aggs_total</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.u_net___lsUseful"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25915.38</span></span>
<span><span class="co"># Calculate PRODUCT aggregates</span></span>
<span><span class="va">pfu_aggs_product</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000mats</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">matrix.name</span>, values_from <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pfu_aggregates.html">pfu_aggregates</a></span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>, fd_sectors <span class="op">=</span> <span class="va">fd_sectors</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"Product"</span><span class="op">)</span></span>
<span><span class="co"># Net primary energy aggregation when last stage is Final</span></span>
<span><span class="co"># Note that all results are now vectors which </span></span>
<span><span class="co"># show aggregation by product</span></span>
<span><span class="va">pfu_aggs_product</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.p_net___lsFinal"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Industry</span></span>
<span><span class="co">#&gt; Crude    50000</span></span>
<span><span class="co">#&gt; NG       43000</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="va">pfu_aggs_product</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.u_net___lsUseful"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         Industry</span></span>
<span><span class="co">#&gt; Light                    1200.00</span></span>
<span><span class="co">#&gt; LTH                     20000.00</span></span>
<span><span class="co">#&gt; MD [from Car engines]    3000.40</span></span>
<span><span class="co">#&gt; MD [from Truck engines]  1714.98</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co"># Calculate INDUSTRY aggregates</span></span>
<span><span class="co"># Note that all results are now vectors which </span></span>
<span><span class="co"># show aggregation by industry</span></span>
<span><span class="va">pfu_aggs_industry</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000mats</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">matrix.name</span>, values_from <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pfu_aggregates.html">pfu_aggregates</a></span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>, fd_sectors <span class="op">=</span> <span class="va">fd_sectors</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"Industry"</span><span class="op">)</span></span>
<span><span class="va">pfu_aggs_industry</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.p_net___lsFinal"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Resources [of Crude] Resources [of NG]</span></span>
<span><span class="co">#&gt; Product                50000             43000</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="va">pfu_aggs_industry</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Energy.type</span> <span class="op">==</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"EX.u_net___lsUseful"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Residential Transport</span></span>
<span><span class="co">#&gt; Product      4200.4  21714.98</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Several functions in the <code>Recca</code> package assist with
aggregations in energy conversion chains.
<code><a href="../reference/primary_aggregates.html">primary_aggregates()</a></code>,
<code><a href="../reference/finaldemand_aggregates.html">finaldemand_aggregates()</a></code>, <code><a href="../reference/region_aggregates.html">region_aggregates()</a></code>,
<code><a href="../reference/despecified_aggregates.html">despecified_aggregates()</a></code>,
<code><a href="../reference/grouped_aggregates.html">grouped_aggregates()</a></code>, and <code><a href="../reference/pfu_aggregates.html">pfu_aggregates()</a></code> all
assist with different types of aggregations. Please see help for these
functions for more details.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Heun, Emmanuel Aramendia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
