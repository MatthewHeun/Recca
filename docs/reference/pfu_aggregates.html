<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculate aggregates at all possible ECC stages
(primary, final, and useful),
regardless of whether the last stage is final or useful.
See details for the approach.
Note that services aggregations are often inherently problematic,
because energy services are often quantified in different units.
This functions does not perform
aggregation to services.
Users are referred to finaldemand_aggregates()
for aggregation to services, if desired and sensible."><title>Aggregate to primary, final, and useful stages — pfu_aggregates • Recca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate to primary, final, and useful stages — pfu_aggregates"><meta property="og:description" content="Calculate aggregates at all possible ECC stages
(primary, final, and useful),
regardless of whether the last stage is final or useful.
See details for the approach.
Note that services aggregations are often inherently problematic,
because energy services are often quantified in different units.
This functions does not perform
aggregation to services.
Users are referred to finaldemand_aggregates()
for aggregation to services, if desired and sensible."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Recca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.55</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/Recca.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Aggregation.html">Aggregation</a>
    <a class="dropdown-item" href="../articles/new-function-interaction.html">new_* function interactions</a>
    <a class="dropdown-item" href="../articles/new-functions.html">new_* functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MatthewHeun/Recca/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Aggregate to primary, final, and useful stages</h1>
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/Recca/blob/HEAD/R/pfu_aggregates.R" class="external-link"><code>R/pfu_aggregates.R</code></a></small>
      <div class="d-none name"><code>pfu_aggregates.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate aggregates at all possible ECC stages
(primary, final, and useful),
regardless of whether the last stage is final or useful.
See details for the approach.
Note that services aggregations are often inherently problematic,
because energy services are often quantified in different units.
This functions does not perform
aggregation to services.
Users are referred to <code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code>
for aggregation to services, if desired and sensible.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pfu_aggregates</span><span class="op">(</span></span>
<span>  <span class="va">.sutdata</span>,</span>
<span>  <span class="va">p_industries</span>,</span>
<span>  <span class="va">fd_sectors</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Total"</span>, <span class="st">"Product"</span>, <span class="st">"Industry"</span>, <span class="st">"Flow"</span><span class="op">)</span>,</span>
<span>  add_net_gross_cols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  piece <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  notation <span class="op">=</span> <span class="fu">RCLabels</span><span class="fu">::</span><span class="va"><a href="https://matthewheun.github.io/RCLabels/reference/notations_list.html" class="external-link">notations_list</a></span>,</span>
<span>  pattern_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exact"</span>, <span class="st">"leading"</span>, <span class="st">"trailing"</span>, <span class="st">"anywhere"</span>, <span class="st">"literal"</span><span class="op">)</span>,</span>
<span>  prepositions <span class="op">=</span> <span class="fu">RCLabels</span><span class="fu">::</span><span class="va"><a href="https://matthewheun.github.io/RCLabels/reference/prepositions_list.html" class="external-link">prepositions_list</a></span>,</span>
<span>  net_aggregate_primary <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_primary</span>,</span>
<span>  gross_aggregate_primary <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_primary</span>,</span>
<span>  net_aggregate_final <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_final</span>,</span>
<span>  gross_aggregate_final <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_final</span>,</span>
<span>  net_aggregate_useful <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_useful</span>,</span>
<span>  gross_aggregate_useful <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_useful</span>,</span>
<span>  net_aggregate_services <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">net_aggregate_services</span>,</span>
<span>  gross_aggregate_services <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="aggregate_cols.html">aggregate_cols</a></span><span class="op">$</span><span class="va">gross_aggregate_services</span>,</span>
<span>  last_stage <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">last_stage</span>,</span>
<span>  primary <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">primary</span>,</span>
<span>  final <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">final</span>,</span>
<span>  useful <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">useful</span>,</span>
<span>  services <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">services</span>,</span>
<span>  sep <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="all_stages.html">all_stages</a></span><span class="op">$</span><span class="va">last_stage_sep</span>,</span>
<span>  R <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">R</span>,</span>
<span>  U <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U</span>,</span>
<span>  U_feed <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_feed</span>,</span>
<span>  U_eiou <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_eiou</span>,</span>
<span>  r_eiou <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">r_eiou</span>,</span>
<span>  V <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">V</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">Y</span>,</span>
<span>  S_units <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">S_units</span>,</span>
<span>  R_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">R</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  U_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  U_feed_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_feed</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  U_eiou_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_eiou</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  r_eiou_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">r_eiou</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  V_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">V</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  Y_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">Y</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  S_units_lsfinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">S_units</span>, <span class="va">sep</span>, <span class="va">final</span><span class="op">)</span>,</span>
<span>  R_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">R</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  U_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  U_feed_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_feed</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  U_eiou_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_eiou</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  r_eiou_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">r_eiou</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  V_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">V</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  Y_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">Y</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  S_units_lsuseful <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">S_units</span>, <span class="va">sep</span>, <span class="va">useful</span><span class="op">)</span>,</span>
<span>  R_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">R</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  U_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  U_feed_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_feed</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  U_eiou_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U_eiou</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  r_eiou_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">r_eiou</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  V_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">V</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  Y_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">Y</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  S_units_lsservices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">S_units</span>, <span class="va">sep</span>, <span class="va">services</span><span class="op">)</span>,</span>
<span>  .matnames <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">matnames</span>,</span>
<span>  .matvals <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">matvals</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.sutdata</dt>
<dd><p>An optional data frame containing physical supply use table
descriptions of energy conversion chains.</p></dd>


<dt>p_industries</dt>
<dd><p>A string vector of primary industries.</p></dd>


<dt>fd_sectors</dt>
<dd><p>A string vector of final demand sectors.</p></dd>


<dt>by</dt>
<dd><p>Tells how to aggregate, one of "Total", "Product", "Industry", or "Flow".
Default is "Total".</p></dd>


<dt>add_net_gross_cols</dt>
<dd><p>A boolean that tells whether to include net and gross columns
for primary energy aggregation.
Default is <code>FALSE</code>.</p></dd>


<dt>piece</dt>
<dd><p>Tells which piece of row and column labels to use for
aggregation decision.
Default is "all".</p></dd>


<dt>notation</dt>
<dd><p>Tells which notation is used for row and column labels.
Default is <code><a href="https://matthewheun.github.io/RCLabels/reference/notations_list.html" class="external-link">RCLabels::notations_list</a></code>.</p></dd>


<dt>pattern_type</dt>
<dd><p>Tells how to match row and column names.
One of "exact", "leading", "trailing", "anywhere", or "literal".
Default is "exact".</p></dd>


<dt>prepositions</dt>
<dd><p>The list of prepositions for row and column labels.
Default is <code><a href="https://matthewheun.github.io/RCLabels/reference/prepositions_list.html" class="external-link">RCLabels::prepositions_list</a></code>.</p></dd>


<dt>net_aggregate_primary, gross_aggregate_primary, net_aggregate_final, gross_aggregate_final, net_aggregate_useful, gross_aggregate_useful, net_aggregate_services, gross_aggregate_services</dt>
<dd><p>See <code><a href="aggregate_cols.html">Recca::aggregate_cols</a></code>.</p></dd>


<dt>last_stage</dt>
<dd><p>Name of the last stage column. Default is <code>Recca::psut_cols$last_stage</code>.</p></dd>


<dt>primary, final, useful, services</dt>
<dd><p>String identifiers for ECC stages. See <code><a href="all_stages.html">Recca::all_stages</a></code>.</p></dd>


<dt>sep</dt>
<dd><p>The string separator identifying the last stage in the ECC.
Default is <code>Recca::all_stages$last_stage_sep</code>.</p></dd>


<dt>R, U, U_feed, U_eiou, r_eiou, V, Y, S_units</dt>
<dd><p>Names for columns containing matrices.
See <code><a href="psut_cols.html">Recca::psut_cols</a></code>.</p></dd>


<dt>R_lsfinal, U_lsfinal, U_feed_lsfinal, U_eiou_lsfinal, r_eiou_lsfinal, V_lsfinal, Y_lsfinal, S_units_lsfinal</dt>
<dd><p>Names for columns when last stage is final energy.
Defaults are unmodified column names concatenated with <code>sep</code>
and <code>final</code>.</p></dd>


<dt>R_lsuseful, U_lsuseful, U_feed_lsuseful, U_eiou_lsuseful, r_eiou_lsuseful, V_lsuseful, Y_lsuseful, S_units_lsuseful</dt>
<dd><p>Names for columns when last stage is useful energy.
Defaults are unmodified column names concatenated with <code>sep</code>
and <code>useful</code>.</p></dd>


<dt>R_lsservices, U_lsservices, U_feed_lsservices, U_eiou_lsservices, r_eiou_lsservices, V_lsservices, Y_lsservices, S_units_lsservices</dt>
<dd><p>Names for columns when last stage is energy services.
Defaults are unmodified column names concatenated with <code>sep</code>
and <code>services</code>.</p></dd>


<dt>.matnames, .matvals</dt>
<dd><p>Names of columns used internally.
Defaults are from <code><a href="psut_cols.html">Recca::psut_cols</a></code>.</p></dd>


<dt>tol</dt>
<dd><p>The allowable energy imbalance in the units of energy flows.
Default is <code>1e-6</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame of primary, final, and useful aggregates.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are several ways to aggregate energy conversion chain (ECC) data
to primary, final, or useful stages of the ECC.
<code><a href="primary_aggregates.html">primary_aggregates()</a></code> aggregates primary energy using the
resource (<strong>R</strong>), make (<strong>V</strong>), and final demand (<strong>Y</strong>) matrices.
<code><a href="primary_aggregates.html">primary_aggregates()</a></code> gives upstream (source) aggregations for an ECC.
<code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code> aggregates to the last stage
of an energy conversion chain using <strong>R</strong> and <strong>Y</strong> matrices,
regardless of whether the last stage is final, useful, or services.
<code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code> gives downstream (sink) aggregations.</p>
<p>However, applying <code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code> to an ECC
whose last stage is final cannot produce useful stage aggregations.
Similarly, applying <code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code> to an ECC whose last stage is useful
cannot provide final stage aggregations.
See the following table.</p><table class="table table"><tr><td>ECC last stage --&gt;</td><td>Final</td><td>Useful</td></tr><tr><td>Desired aggregation stage</td><td></td><td></td></tr><tr><td>Primary</td><td><code><a href="primary_aggregates.html">primary_aggregates()</a></code> Note A</td><td><code><a href="primary_aggregates.html">primary_aggregates()</a></code> Note A</td></tr><tr><td>Final</td><td><code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code></td><td>Note B</td></tr><tr><td>Useful</td><td>Note C</td><td><code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code></td></tr></table><p>For the off-axis aggregations, special considerations are employed in this function.</p>
<p>Note A:</p>
<p>The two results from <code><a href="primary_aggregates.html">primary_aggregates()</a></code>
should be equal to within <code>tol</code>.
If agreement is not observed, an error is given.</p>
<p>Note B:</p>
<p>When last stage is useful but we want final stage aggregations
and final-to-useful stage efficiencies,
we can again employ <code><a href="calc_eta_fu_Y_eiou.html">calc_eta_fu_Y_eiou()</a></code> in an inverse
relationship to calculate final stage aggregates when
useful stage information is known.
The result is <strong>Y</strong> and <strong>U_EIOU</strong> matrices
of same structure as <strong>Y_Useful</strong> and <strong>U_EIOU_Useful</strong> but containing
final stage data.
These final-but-in-same-structure-as-useful matrices
can be used to calculate final aggregations when last stage is useful.</p>
<p>Note C:</p>
<p>When last stage is final but we want useful energy aggregates
and final-to-useful efficiencies,
we can employ <code><a href="calc_eta_fu_Y_eiou.html">calc_eta_fu_Y_eiou()</a></code> to calculate
useful energy for each piece of final demand or EIOU
when last stage is final, giving <strong>Y</strong> and <strong>U_EIOU</strong>
matrices with same structure as <strong>Y_Final</strong> and <strong>U_EIOU_Final</strong>
except containing useful energy data.
These useful-but-in-same-structure-as-final matrices
can be used to calculate useful aggregations when last stage is final.</p>
<p>Whereas <code><a href="primary_aggregates.html">primary_aggregates()</a></code> and <code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code>
work independently of the last stage of an ECC,
this function requires both final and useful last stage ECCs
to be present in <code>.sutdata</code>.
Any data with last state of services are ignored in this function.</p>
<p>Suffixes to matrix names are assumed to indicate the last stage
of the ECC for which the matrix applies.
For example, two versions of the <strong>R</strong> matrix should be present:
<code>R_final</code> and <code>R_useful</code>.</p>
<p>If <code>.sutdata</code> is a wide-by-matrices data frame
but contains a <code>last_stage</code> column,
<code>.sutdata</code> is pivoted wide (as a convenience)
to put data into the correct shape,
forming columns for each combination of ECC matrix and last stage.
The <code>last_stage</code> and <code>R</code> columns make <code>R_final</code> and <code>R_useful</code> columns.
The <code>last_stage</code> and <code>V</code> columns make <code>V_final</code> and <code>V_useful</code> columns.
Etc.
If either the last stage final or the last stage useful ECC representations
is missing, an error is thrown.
See examples.</p>
<p>Internally, this function uses
<code><a href="primary_aggregates.html">primary_aggregates()</a></code> and <code><a href="finaldemand_aggregates.html">finaldemand_aggregates()</a></code>
to complete its work.</p>
<p>Primary aggregates can be computed when
last stage is final, useful, or services.
Ostensibly, the primary aggregates should be the same
in all cases when metadata are the same.
An error is thrown if that is not true to within <code>tol</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">p_industries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Resources [of Crude]"</span>, <span class="st">"Resources [of NG]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fd_sectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Residential"</span>, <span class="st">"Transport"</span>, <span class="st">"Oil fields"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Primary TOTAL aggregates</span></span></span>
<span class="r-in"><span><span class="va">UKEnergy2000mats</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">matrix.name</span>, values_from <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="co"># Eliminate the case when last_stage == "Final"</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">last_stage</span><span class="op">]</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"Final"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">pfu_aggregates</span><span class="op">(</span>p_industries <span class="op">=</span> <span class="va">p_industries</span>, fd_sectors <span class="op">=</span> <span class="va">fd_sectors</span>,</span></span>
<span class="r-in"><span>                by <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 43</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country  Year Energy.type R___lsUseful  U___lsUseful    U_feed___lsUseful</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> GBR      <span style="text-decoration: underline;">2</span>000 E           <span style="color: #949494;">&lt;dbl [2 × 2]&gt;</span> <span style="color: #949494;">&lt;dbl [13 × 13]&gt;</span> <span style="color: #949494;">&lt;dbl [12 × 13]&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> GBR      <span style="text-decoration: underline;">2</span>000 X           <span style="color: #949494;">&lt;NULL&gt;</span>        <span style="color: #949494;">&lt;NULL&gt;</span>          <span style="color: #949494;">&lt;NULL&gt;</span>           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 37 more variables: U_EIOU___lsUseful &lt;list&gt;, r_EIOU___lsUseful &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   V___lsUseful &lt;list&gt;, Y___lsUseful &lt;list&gt;, S_units___lsUseful &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   R___lsServices &lt;list&gt;, U___lsServices &lt;list&gt;, U_feed___lsServices &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   U_EIOU___lsServices &lt;list&gt;, r_EIOU___lsServices &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   V___lsServices &lt;list&gt;, Y___lsServices &lt;list&gt;, S_units___lsServices &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   EX.p_net___lsFinal &lt;list&gt;, EX.p_gross___lsFinal &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   EX.p_net___lsUseful &lt;list&gt;, EX.p_gross___lsUseful &lt;list&gt;, …</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matthew Heun, Emmanuel Aramendia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

