<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>new_* function interactions • Recca</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="new_* function interactions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Recca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.64</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Recca.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Aggregation.html">Aggregation</a></li>
    <li><a class="dropdown-item" href="../articles/new-function-interaction.html">new_* function interactions</a></li>
    <li><a class="dropdown-item" href="../articles/new-functions.html">new_* functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MatthewHeun/Recca/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="new-function-interaction_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="new-function-interaction_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="new-function-interaction_files/d3-4.9.1/d3.min.js"></script><script src="new-function-interaction_files/sankey-1/sankey.js"></script><script src="new-function-interaction_files/sankeyNetwork-binding-0.4.1/sankeyNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>new_* function interactions</h1>
                        <h4 data-toc-skip class="author">Matthew Kuperus
Heun</h4>
            
            <h4 data-toc-skip class="date">2025-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/Recca/blob/v0.1.64/vignettes/new-function-interaction.Rmd" class="external-link"><code>vignettes/new-function-interaction.Rmd</code></a></small>
      <div class="d-none name"><code>new-function-interaction.Rmd</code></div>
    </div>

    
    
<!-- Establish some helpful LaTeX shortcuts for equations -->
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The <code>Recca</code> package provides several <code>new_*</code>
functions that allow the user to estimate a new version of an energy
conversion chain (ECC) based on localized changed to one portion of the
ECC. The functions can have some interesting interactions, particularly
if they are called sequentially. This vignette show how to understand
and deal with those interactions. The functions <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code>
and <code><a href="../reference/new_Y.html">new_Y()</a></code> are used for this purpose.</p>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>To investigate the interactions, we first make the simplest possible
ECC that retains the features to be tested, a minimum working example
(MWE). This example has two resource industries (R1 and R2), one
intermediate industry (I), and two final demand sectors (Y1 and Y2). The
R1 industry makes product R1p.<br>
The R2 industry makes product R2p. Industry I makes product Ip. Product
Ip is consumed by final demand sectors Y1 and Y2.</p>
<p>The resources
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐑</mi><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math>),
use
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐔</mi><annotation encoding="application/x-tex">\mathbf{U}</annotation></semantics></math>),
make
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐕</mi><annotation encoding="application/x-tex">\mathbf{V}</annotation></semantics></math>),
final demand
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐘</mi><annotation encoding="application/x-tex">\mathbf{Y}</annotation></semantics></math>),
and unit summation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐒</mi><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{S}_{units}</annotation></semantics></math>)
matrices are given below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthewHeun/matsbyname" class="external-link">matsbyname</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthewHeun/Recca" class="external-link">Recca</a></span><span class="op">)</span></span>
<span><span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>,  <span class="fl">0</span><span class="op">)</span>,</span>
<span>            byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1"</span>, <span class="st">"R2"</span>, <span class="st">"I"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Industries"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># There is no EIOU, so U_feed and U are the same.</span></span>
<span><span class="va">U_feed</span> <span class="op">&lt;-</span> <span class="va">U</span></span>
<span></span>
<span><span class="va">R_plus_V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,  <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                     <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0</span>, </span>
<span>                     <span class="fl">0</span>,  <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>                   byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                   dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1"</span>, <span class="st">"R2"</span>, <span class="st">"I"</span><span class="op">)</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Industries"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RV_mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/separate_RV.html">separate_RV</a></span><span class="op">(</span>U <span class="op">=</span> <span class="va">U</span>, R_plus_V <span class="op">=</span> <span class="va">R_plus_V</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="va">RV_mats</span><span class="op">$</span><span class="va">R</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="va">RV_mats</span><span class="op">$</span><span class="va">V</span></span>
<span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>              <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>            byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Industries"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">S_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, </span>
<span>                    <span class="fl">1</span>, </span>
<span>                    <span class="fl">1</span><span class="op">)</span>, </span>
<span>                  byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quad"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Units"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll use Sankey diagrams to visualize several ECCs. The
<code><a href="../reference/make_sankey.html">make_sankey()</a></code> function creates the diagrams. A Sankey
diagram that shows the base energy conversion chain is shown below.
<code><a href="../reference/make_sankey.html">make_sankey()</a></code> returns a list with a named item “Sankey”
that we must extract to insert the diagram into this vignette.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_sankey.html">make_sankey</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">R</span>, U <span class="op">=</span> <span class="va">U</span>, V <span class="op">=</span> <span class="va">V</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"Sankey"</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"links":{"source":[0,0,1,2],"target":[3,4,0,0],"value":[2,2,10,10],"group":["Ip","Ip","R1p","R2p"]},"nodes":{"name":["I","R1","R2","Y1","Y2"],"group":["I","R1","R2","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":"Product","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="adjust-inputs-to-industry-i">Adjust inputs to industry I<a class="anchor" aria-label="anchor" href="#adjust-inputs-to-industry-i"></a>
</h3>
<p>We can change the proportion of inputs to industry I using
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code>. To do so, we must first calculate the
input-output structure of the ECC using the <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code>
function. Then, we call the <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> function with a new
k vector that indicates industry I now uses 20 quads of <code>R1</code>
instead of a 50/50 split between <code>R1</code> and
<code>R2</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthewHeun/Recca" class="external-link">Recca</a></span><span class="op">)</span></span>
<span><span class="va">iomats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_io_mats.html">calc_io_mats</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">R</span>, U <span class="op">=</span> <span class="va">U</span>, U_feed <span class="op">=</span> <span class="va">U_feed</span>, V <span class="op">=</span> <span class="va">V</span>, Y <span class="op">=</span> <span class="va">Y</span>, S_units <span class="op">=</span> <span class="va">S_units</span><span class="op">)</span></span>
<span><span class="va">k_prime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                    <span class="fl">0</span><span class="op">)</span>, </span>
<span>                  byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Industries"</span><span class="op">)</span></span>
<span><span class="va">change_input_proportions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_k_ps.html">new_k_ps</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iomats</span>, </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">R</span>, U <span class="op">=</span> <span class="va">U</span>, V <span class="op">=</span> <span class="va">V</span>, Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>                                            S_units <span class="op">=</span> <span class="va">S_units</span>, </span>
<span>                                            k_prime <span class="op">=</span> <span class="va">k_prime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># There is no EIOU, so U and U_feed are same.</span></span>
<span><span class="va">change_input_proportions</span><span class="op">[[</span><span class="st">"U_feed_prime"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">change_input_proportions</span><span class="op">[[</span><span class="st">"U_prime"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/make_sankey.html">make_sankey</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">R_prime</span>, </span>
<span>            U <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">U_prime</span>, </span>
<span>            V <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">V_prime</span>, </span>
<span>            Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"Sankey"</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"links":{"source":[0,0,1],"target":[2,3,0],"value":[2,2,20],"group":["Ip","Ip","R1p"]},"nodes":{"name":["I","R1","Y1","Y2"],"group":["I","R1","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":"Product","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="change-final-demand">Change final demand<a class="anchor" aria-label="anchor" href="#change-final-demand"></a>
</h3>
<p>We can calculate the ECC that would be required to meet a new level
of final demand with the <code><a href="../reference/new_Y.html">new_Y()</a></code> function. The
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> and <code><a href="../reference/new_Y.html">new_Y()</a></code> functions interact in
ways that might be surprising to the user, depending on whether the
input-output structure of the ECC is re-calculated between sequential
function calls.</p>
<div class="section level4">
<h4 id="without-recalculating-the-structure-of-the-ecc">Without recalculating the structure of the ECC<a class="anchor" aria-label="anchor" href="#without-recalculating-the-structure-of-the-ecc"></a>
</h4>
<p>Now let’s change final demand, saying that consumption by Y1 doubles.
But we’ll call <code><a href="../reference/new_Y.html">new_Y()</a></code> <em>without</em> recalculating the
structure of the ECC with the <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y_prime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>                    <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                  byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1p"</span>, <span class="st">"R2p"</span>, <span class="st">"Ip"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setrowtype.html" class="external-link">setrowtype</a></span><span class="op">(</span><span class="st">"Products"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Industries"</span><span class="op">)</span></span>
<span><span class="va">change_final_demand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_Y.html">new_Y</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iomats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Y_prime <span class="op">=</span> <span class="va">Y_prime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_sankey.html">make_sankey</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">change_final_demand</span><span class="op">$</span><span class="va">R_prime</span>, </span>
<span>            U <span class="op">=</span> <span class="va">change_final_demand</span><span class="op">$</span><span class="va">U_prime</span>, </span>
<span>            V <span class="op">=</span> <span class="va">change_final_demand</span><span class="op">$</span><span class="va">V_prime</span>, </span>
<span>            Y <span class="op">=</span> <span class="va">change_final_demand</span><span class="op">$</span><span class="va">Y_prime</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"Sankey"</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"links":{"source":[0,0,1,2],"target":[3,4,0,0],"value":[4,2,15,15],"group":["Ip","Ip","R1p","R2p"]},"nodes":{"name":["I","R1","R2","Y1","Y2"],"group":["I","R1","R2","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":"Product","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>Industry I is back to using both R1p and R2p in a 50/50 split to make
its output. Both R1p and R2p now supply 15 quads to I to account for
increased final demand.</p>
<p>The <code><a href="../reference/new_Y.html">new_Y()</a></code> function is performing exactly as expected,
given that <code>iomats</code> was supplied to <code><a href="../reference/new_Y.html">new_Y()</a></code>.
<code>iomats</code> contains information about an ECC in which industry
I’s inputs are split 50/50 between R1p and R2p. So when
<code><a href="../reference/new_Y.html">new_Y()</a></code> calculates a new ECC, it assumes that industry I’s
needs are a 50/50 split between R1p and R2p.</p>
<p>In fact, it would be a mistake to think that <code><a href="../reference/new_Y.html">new_Y()</a></code>
would give anything but a 50/50 split between R1p and R2p when using the
<code>iomats</code> description of the ECC.</p>
</div>
<div class="section level4">
<h4 id="after-recalculating-the-structure-of-the-ecc">After recalculating the structure of the ECC<a class="anchor" aria-label="anchor" href="#after-recalculating-the-structure-of-the-ecc"></a>
</h4>
<p>If you want <code><a href="../reference/new_Y.html">new_Y()</a></code> to start from the Sankey in which
all energy supplied to industry I comes from R1p, you need to first
recalculate the input-output structure of the ECC based on the ECC in
which industry I uses only R1p. I.e., you need to re-calculate an
<code>iomats</code> object after calling <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> and
before calling <code><a href="../reference/new_Y.html">new_Y()</a></code>. Then, you must submit that updated
description of the input-output structure of the ECC to
<code><a href="../reference/new_Y.html">new_Y()</a></code>. The following code demonstrates the approach.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iomats2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_io_mats.html">calc_io_mats</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">R_prime</span>, </span>
<span>                        U <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">U_prime</span>, </span>
<span>                        U_feed <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">U_feed_prime</span>,</span>
<span>                        V <span class="op">=</span> <span class="va">change_input_proportions</span><span class="op">$</span><span class="va">V_prime</span>, </span>
<span>                        Y <span class="op">=</span> <span class="va">Y</span>, S_units <span class="op">=</span> <span class="va">S_units</span><span class="op">)</span></span>
<span><span class="va">change_final_demand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_Y.html">new_Y</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iomats2</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Y_prime <span class="op">=</span> <span class="va">Y_prime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_sankey.html">make_sankey</a></span><span class="op">(</span>R <span class="op">=</span> <span class="va">change_final_demand2</span><span class="op">$</span><span class="va">R_prime</span>, </span>
<span>            U <span class="op">=</span> <span class="va">change_final_demand2</span><span class="op">$</span><span class="va">U_prime</span>, </span>
<span>            V <span class="op">=</span> <span class="va">change_final_demand2</span><span class="op">$</span><span class="va">V_prime</span>, </span>
<span>            Y <span class="op">=</span> <span class="va">change_final_demand2</span><span class="op">$</span><span class="va">Y_prime</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"Sankey"</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"links":{"source":[0,0,1],"target":[2,3,0],"value":[4,2,30],"group":["Ip","Ip","R1p"]},"nodes":{"name":["I","R1","Y1","Y2"],"group":["I","R1","Y1","Y2"]},"options":{"NodeID":"Node","NodeGroup":"Node","LinkGroup":"Product","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>The Sankey diagram above shows that we have successfully increased
the demand from <code>Y1</code> while ensuring that all inputs to
industry I come from R1p. The “trick” is to recalculate the input-output
structure of the ECC between the two steps.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>new_*</code> function of the <code>Recca</code> package can
be called sequentially. But the interactions among the
<code>new_*</code> functions can be surprising if their behavior is not
fully understood. This vignette provides a detailed example using the
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> and <code><a href="../reference/new_Y.html">new_Y()</a></code> functions. If they are
called sequentially <em>without</em> first recalculating the
input-output structure of the ECC, the call to <code><a href="../reference/new_Y.html">new_Y()</a></code> will
be based on the original input-output structure of the ECC (from before
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> was called). If <code><a href="../reference/calc_io_mats.html">calc_io_mats()</a></code> is
called between the sequential calls to <code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> and
<code><a href="../reference/new_Y.html">new_Y()</a></code> and the results are fed to <code><a href="../reference/new_Y.html">new_Y()</a></code>,
the input-output structure of the ECC <em>after</em> calling
<code><a href="../reference/new_k_ps.html">new_k_ps()</a></code> will be used for the calculations by
<code><a href="../reference/new_Y.html">new_Y()</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Heun, Emmanuel Aramendia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
