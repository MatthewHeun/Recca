<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Endogenize losses into PSUT matrices — endogenize_losses • Recca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Endogenize losses into PSUT matrices — endogenize_losses"><meta name="description" content="When a conversion chain does not include losses in the
RUVY matrices of the PSUT framework,
it may be helpful to endogenize the losses.
This function performs the endogenization."><meta property="og:description" content="When a conversion chain does not include losses in the
RUVY matrices of the PSUT framework,
it may be helpful to endogenize the losses.
This function performs the endogenization."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Recca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.66</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/Recca.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Aggregation.html">Aggregation</a></li>
    <li><a class="dropdown-item" href="../articles/balances.html">Balances</a></li>
    <li><a class="dropdown-item" href="../articles/new-function-interaction.html">new_* function interactions</a></li>
    <li><a class="dropdown-item" href="../articles/new-functions.html">new_* functions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MatthewHeun/Recca/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Endogenize losses into PSUT matrices</h1>
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/Recca/blob/v0.1.66/R/endogenize_losses.R" class="external-link"><code>R/endogenize_losses.R</code></a></small>
      <div class="d-none name"><code>endogenize_losses.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When a conversion chain does <em>not</em> include losses in the
<strong>RUVY</strong> matrices of the PSUT framework,
it may be helpful to endogenize the losses.
This function performs the endogenization.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">endogenize_losses</span><span class="op">(</span></span>
<span>  .sutmats <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">R</span>,</span>
<span>  U <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">U</span>,</span>
<span>  V <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">V</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="psut_cols.html">psut_cols</a></span><span class="op">$</span><span class="va">Y</span>,</span>
<span>  intra_industry_balance <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="balance_cols.html">balance_cols</a></span><span class="op">$</span><span class="va">intra_industry_balance_colname</span>,</span>
<span>  losses_alloc <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="balance_cols.html">balance_cols</a></span><span class="op">$</span><span class="va">losses_alloc_colname</span>,</span>
<span>  loss_sector <span class="op">=</span> <span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="balance_cols.html">balance_cols</a></span><span class="op">$</span><span class="va">losses_sector</span>,</span>
<span>  replace_cols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  V_prime <span class="op">=</span> <span class="st">"V_prime"</span>,</span>
<span>  Y_prime <span class="op">=</span> <span class="st">"Y_prime"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--sutmats">.sutmats<a class="anchor" aria-label="anchor" href="#arg--sutmats"></a></dt>
<dd><p>A <code>matsindf</code> data frame, wide by matrices, or
a list of lists of matrices.
Default is <code>NULL</code>.</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>Resources (<strong>R</strong>) matrix or name of the column in <code>.sutmats</code>
that contains same.
Default is "R".</p></dd>


<dt id="arg-u">U<a class="anchor" aria-label="anchor" href="#arg-u"></a></dt>
<dd><p>Use (<strong>U</strong>) matrix or name of the column in <code>.sutmats</code>
that contains same.
Necessary for verifying calculating losses.
Default is "U".</p></dd>


<dt id="arg-v">V<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>Make (<strong>V</strong>) matrix or name of the column in <code>.sutmats</code>
that contains same.
Default is "V".</p></dd>


<dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Final demand (<strong>Y</strong>) matrix or name
of the column in <code>.sutmats</code> that contains same.
Default is "Y".</p></dd>


<dt id="arg-intra-industry-balance">intra_industry_balance<a class="anchor" aria-label="anchor" href="#arg-intra-industry-balance"></a></dt>
<dd><p>A vector or the name of the column containing
intra-industry balance vectors.
If missing, losses are calculated internally
with <code><a href="balances.html">calc_intra_industry_balance()</a></code>
before endogenizing.
Default is
<a href="balance_cols.html">balance_cols</a><code>$intra_industry_balance_colname</code> or
"SUTIntraIndustryBalance".</p></dd>


<dt id="arg-losses-alloc">losses_alloc<a class="anchor" aria-label="anchor" href="#arg-losses-alloc"></a></dt>
<dd><p>A matrix or the name of the column containing
loss allocation matrices.
See details for structure of this matrix.
Default is <a href="balance_cols.html">balance_cols</a><code>$losses_alloc_colname</code> or
"LossesAlloc".</p></dd>


<dt id="arg-loss-sector">loss_sector<a class="anchor" aria-label="anchor" href="#arg-loss-sector"></a></dt>
<dd><p>The string name of the sector
that will absorb losses in the <strong>Y</strong> matrix.
Default is <a href="balance_cols.html">balance_cols</a><code>$losses_sector</code>
or "Transformation losses".</p></dd>


<dt id="arg-replace-cols">replace_cols<a class="anchor" aria-label="anchor" href="#arg-replace-cols"></a></dt>
<dd><p>A boolean that tells whether to
(a) replace
the <code>V</code> and <code>Y</code> columns with
<code>V_prime</code> and <code>Y_prime</code> columns, respectively and
(b) delete the <code>V_prime</code>, <code>Y_prime</code>, <code>balance_colname</code>, and
<code>losses_alloc_colname</code> columns
after endogenizing the losses
when <code>.sutmats</code> is a data frame or a list.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-clean">clean<a class="anchor" aria-label="anchor" href="#arg-clean"></a></dt>
<dd><p>A boolean that tells whether the outgoing
<code>V_prime</code> and <code>Y_prime</code> matrices should have
<code>0</code> rows and columns removed.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>The maximum allowable difference from <code>1</code> for the rowsums of
loss allocation matrices.
Default is <code>1e-6</code>.</p></dd>


<dt id="arg-v-prime">V_prime<a class="anchor" aria-label="anchor" href="#arg-v-prime"></a></dt>
<dd><p>The name of the <strong>V</strong> matrix with endogenized losses.</p></dd>


<dt id="arg-y-prime">Y_prime<a class="anchor" aria-label="anchor" href="#arg-y-prime"></a></dt>
<dd><p>The name of the <strong>Y</strong> matrix with endogenized losses.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A version of the conversion chain with losses endogenized.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function endogenizes losses into the <strong>V</strong> and <strong>Y</strong> matrices,
because losses are made (<strong>V</strong>) by industries
and gathered by final demand (<strong>Y</strong>).
By default, this function creates new
<code>V_prime</code> and <code>Y_prime</code> matrices.
Setting <code>replace_cols = TRUE</code>
(default is <code>FALSE</code>)
replaces the existing
<code>V</code> and <code>Y</code> matrices with <code>V_prime</code> and <code>Y_prime</code>,
respectively.</p>
<p>All losses are allocated to the
<code>loss_sector</code> column in the <strong>Y</strong> matrix,
by default named
<a href="balance_cols.html">balance_cols</a><code>$losses_sector or "</code>r Recca::balance_cols$losses_sector`".</p><div class="section">
<h3 id="endogenizing-algorithm">Endogenizing algorithm<a class="anchor" aria-label="anchor" href="#endogenizing-algorithm"></a></h3>


<p>The endogenizing algorithm is this:</p><ul><li><p>If not present,
calculate the balance vector with
<code><a href="balances.html">calc_intra_industry_balance()</a></code>.</p></li>
<li><p>Hatize the balance vector
with <code><a href="https://matthewheun.github.io/matsbyname/reference/hatize_byname.html" class="external-link">matsbyname::hatize_byname()</a></code>.</p></li>
<li><p>Matrix multiply the hatized balance vector and
the losses_allocation matrix (<code>losses_alloc</code>)
to obtain a matrix to be added to <strong>V</strong>.</p></li>
<li><p>Transpose the matrix to be added to <strong>V</strong>,
calculate rowsums, and
set the column name to <code>loss_sector</code>
to obtain a matrix to be added to <strong>Y</strong>.</p></li>
<li><p>Add the matrices to <strong>V</strong> and <strong>Y</strong>, respectively.</p></li>
</ul></div>

<div class="section">
<h3 id="losses-allocation-matrix">Losses allocation matrix<a class="anchor" aria-label="anchor" href="#losses-allocation-matrix"></a></h3>


<p>The losses allocation matrix (<code>losses_alloc</code>) tells how losses from
each industry should be allocated to products.
The losses allocation matrix should have
industries in rows and
products (losses) in rows.
The values in the losses allocation matrix are fractions
of each industry's losses (in rows) that are allocated
to loss products (in columns).
Rows of losses allocation matrix must sum to <code>1</code>.
The value of <code>losses_alloc</code> must resolve to a matrix
of this form.
Options include:</p><ul><li><p>The default value, namely
<a href="balance_cols.html">balance_cols</a><code>$default_losses_alloc</code>,
a 1x1 matrix with
a row named "All industries",
a column named "Waste heat", and
a value of <code>1</code>.
This default matrix ascribes losses from all industries
in the <strong>V</strong> matrix
to a product called "Waste heat".</p></li>
<li><p>A matrix of the same sense
(industries in rows,
waste products in columns,
rows sum to 1.0)
to be applied to all
rows in the wide-by-matrices data frame supplied
in <code>.sutmats</code>.
All industries in the <strong>V</strong> matrix must be present
in the rows of <code>losses_alloc</code>.
If the matrix has a single row
(as the default, <a href="balance_cols.html">balance_cols</a><code>$default_losses_alloc</code>),
it is assumed to apply to all industries.</p></li>
<li><p>The string name of a column in <code>.sutmats</code>
that contains loss allocation matrices for every row
in <code>.sutmats</code>.
All industries in the <strong>V</strong> matrix must be present
in the rows of the matrices in the <code>losses_alloc</code> column.
If any of the matrices in the column names <code>losses_alloc</code>
has a single row,
the row is assumed to apply to all industries.</p></li>
</ul></div>

<div class="section">
<h3 id="intra-industry-balances">Intra-industry balances<a class="anchor" aria-label="anchor" href="#intra-industry-balances"></a></h3>


<p>The intra-industry losses to be endogenized
are found in <code>intra_industry_balance</code>
and can be calculated with <code><a href="balances.html">calc_intra_industry_balance()</a></code>.
If <code>intra_industry_balance</code> is not present,
it is calculated internally via
<code><a href="balances.html">calc_intra_industry_balance()</a></code>.</p>
</div>

<div class="section">
<h3 id="cleaning">Cleaning<a class="anchor" aria-label="anchor" href="#cleaning"></a></h3>


<p>When this function operates
on a conversion chain with already-balanced industries,
the matrices to be added to <strong>V</strong> and <strong>Y</strong>
will be the <strong>0</strong> matrix to within <code>tol</code>.
Setting <code>clean = TRUE</code> removes those rows or columns
from the output <code>V_prime</code> and <code>Y_prime</code> matrices.</p>
</div>

<div class="section">
<h3 id="checks">Checks<a class="anchor" aria-label="anchor" href="#checks"></a></h3>


<p>Prior to performing any calculations,
<code><a href="verify-balances.html">verify_inter_industry_balance()</a></code> is checked.
There is no point endogenizing losses for
a conversion chain that is not internally consistent.</p>
<p>After endogenizing the losses,
all industries in the conversion chain
should pass <code><a href="verify-balances.html">verify_intra_industry_balance()</a></code>,
a condition that is checked before returning.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mats</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000mats</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">matrix.name</span>,</span></span>
<span class="r-in"><span>                     values_from <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="https://matthewheun.github.io/IEATools/reference/iea_cols.html" class="external-link">iea_cols</a></span><span class="op">$</span><span class="va">last_stage</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="https://matthewheun.github.io/IEATools/reference/last_stages.html" class="external-link">last_stages</a></span><span class="op">$</span><span class="va">final</span>, <span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="https://matthewheun.github.io/IEATools/reference/last_stages.html" class="external-link">last_stages</a></span><span class="op">$</span><span class="va">useful</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="co"># Add a matrix column of loss allocations.</span></span></span>
<span class="r-in"><span>    <span class="co"># This bit of code adds a default loss allocation matrix</span></span></span>
<span class="r-in"><span>    <span class="co"># to every row of the data frame.</span></span></span>
<span class="r-in"><span>    <span class="st">"{Recca::balance_cols$losses_alloc_colname}"</span> <span class="op">:=</span></span></span>
<span class="r-in"><span>      <span class="fu">RCLabels</span><span class="fu">::</span><span class="fu"><a href="https://matthewheun.github.io/RCLabels/reference/make_list.html" class="external-link">make_list</a></span><span class="op">(</span><span class="fu">Recca</span><span class="fu">::</span><span class="va"><a href="balance_cols.html">balance_cols</a></span><span class="op">$</span><span class="va">default_losses_alloc</span>,</span></span>
<span class="r-in"><span>                          n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          lenx <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">mats</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rows: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: 13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Country     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GBR"<span style="color: #949494;">, </span>"GBR"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Year        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2000<span style="color: #949494;">, </span>2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ EnergyType  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E"<span style="color: #949494;">, </span>"E"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ LastStage   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final"<span style="color: #949494;">, </span>"Useful"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ R           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[2 x 2]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[2 x 2]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_EIOU      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[7 x 8]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[3 x 8]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_feed      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[12 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ V           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 10]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 14]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Y           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[4 x 2]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[4 x 2]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ r_EIOU      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ S_units     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 1]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[16 x 1]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ LossesAlloc <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;matrix[1 x 1]&gt;<span style="color: #949494;">, </span>&lt;matrix[1 x 1]&gt;</span>
<span class="r-in"><span><span class="va">mats</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="balances.html">calc_intra_industry_balance</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">endogenize_losses</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rows: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: 16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Country                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GBR"<span style="color: #949494;">, </span>"GBR"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Year                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2000<span style="color: #949494;">, </span>2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ EnergyType              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E"<span style="color: #949494;">, </span>"E"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ LastStage               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final"<span style="color: #949494;">, </span>"Useful"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ R                       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[2 x 2]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[2 x 2]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U                       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_EIOU                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[7 x 8]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[3 x 8]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_feed                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[12 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ V                       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 10]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 14]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Y                       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[4 x 2]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[4 x 2]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ r_EIOU                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ S_units                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 1]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[16 x 1]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ LossesAlloc             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;matrix[1 x 1]&gt;<span style="color: #949494;">, </span>&lt;matrix[1 x 1]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ SUTIntraIndustryBalance <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 1]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 1]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ V_prime                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 11]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 15]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Y_prime                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[5 x 3]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[5 x 3]&gt;&gt;</span>
<span class="r-in"><span><span class="co"># Replace original matrices with endogenized matrices</span></span></span>
<span class="r-in"><span><span class="va">mats</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="balances.html">calc_intra_industry_balance</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">endogenize_losses</span><span class="op">(</span>replace_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="co"># Check the intra-industry balance.</span></span></span>
<span class="r-in"><span>  <span class="co"># Everything should be balanced now.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="balances.html">calc_intra_industry_balance</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="verify-balances.html">verify_intra_industry_balance</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rows: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: 14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Country                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GBR"<span style="color: #949494;">, </span>"GBR"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Year                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2000<span style="color: #949494;">, </span>2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ EnergyType               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E"<span style="color: #949494;">, </span>"E"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ LastStage                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final"<span style="color: #949494;">, </span>"Useful"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ R                        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[2 x 2]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[2 x 2]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U                        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_EIOU                   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[7 x 8]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[3 x 8]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ U_feed                   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[12 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ V                        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 11]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 15]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ Y                        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[5 x 3]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[5 x 3]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ r_EIOU                   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 9]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 13]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ S_units                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[12 x 1]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[16 x 1]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ SUTIntraIndustryBalance  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[9 x 1]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[13 x 1]&gt;&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ SUTIntraIndustryBalanced <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE<span style="color: #949494;">, </span>TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Heun, Emmanuel Aramendia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

